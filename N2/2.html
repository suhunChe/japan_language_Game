<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N2/N3 í…Œë§ˆë³„ í•œì ê²Œì„</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4a90e2; 
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Pretendard', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #357abd; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #f4f6f8; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* ì „ì²´ ë˜í¼ */
        #wp-hanja-game-wrapper {
            font-family: 'Pretendard', sans-serif;
            background-color: #f4f6f8;
            border-radius: 12px;
            padding: 20px;
            max-width: 900px; /* ì¹´ë“œê°€ ë§ìœ¼ë¯€ë¡œ ë„ˆë¹„ë¥¼ ì¡°ê¸ˆ ëŠ˜ë ¸ìŠµë‹ˆë‹¤ */
            margin: 0 auto 20px auto;
            box-sizing: border-box;
            border: 1px solid #e1e4e8;
            position: relative;
        }
        #wp-hanja-game-wrapper * { box-sizing: border-box; }

        /* í—¤ë” ë° ë²„íŠ¼ ì˜ì—­ */
        #wp-hanja-game-wrapper header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e4e8;
            text-align: center;
        }
        #wp-hanja-game-wrapper h2.game-title {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.5rem;
            font-weight: 800;
        }

        /* ì„¸íŠ¸ ì„ íƒ ë²„íŠ¼ ê·¸ë£¹ */
        #wp-hanja-game-wrapper .set-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }
        #wp-hanja-game-wrapper .btn-set {
            padding: 12px 24px;  /* ìƒí•˜ 12px, ì¢Œìš° 24px */
            font-size: 1.1rem;   /* ê¸€ì í¬ê¸° 1.1ë°° */
            background-color: #fff;
            color: #555;
            border: 2px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        #wp-hanja-game-wrapper .btn-set:hover {
            border-color: #4a90e2;
            color: #4a90e2;
        }
        #wp-hanja-game-wrapper .btn-set.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }
        #wp-hanja-game-wrapper .btn-set.random-set {
            border-color: #9b59b6;
            color: #9b59b6;
        }
        #wp-hanja-game-wrapper .btn-set.random-set.active {
            background-color: #9b59b6;
            color: white;
        }

        /* ìƒíƒœë°” */
        #wp-hanja-game-wrapper .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            font-size: 1.1rem;
            color: #555;
            flex-wrap: wrap;
        }
        #wp-hanja-game-wrapper .score-text { color: #4a90e2; font-weight: bold; }

        /* ê²Œì„ ë³´ë“œ */
        #wp-hanja-game-wrapper .game-board {
            display: flex;
            gap: 20px;
            width: 100%;
            align-items: flex-start;
            position: relative;
        }
        #wp-hanja-game-wrapper .game-section {
            flex: 1;
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        #wp-hanja-game-wrapper .col-header {
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ddd;
        }
        #wp-hanja-game-wrapper .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); 
            gap: 10px;
        }
        @media (min-width: 768px) {
            #wp-hanja-game-wrapper .card-grid { grid-template-columns: repeat(5, 1fr); }
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        #wp-hanja-game-wrapper .game-card {
            background-color: #ffffff;
            border: 2px solid #ddd;
            border-radius: 8px;
            height: 110px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s ease;
            user-select: none;
            box-shadow: 0 2px 3px rgba(0,0,0,0.05);
            padding: 4px;
            line-height: 1.2;
            word-break: keep-all;
        }
        #wp-hanja-game-wrapper .game-card.hanja {
            font-size: 2.4rem;
            font-weight: 800;
            font-family: sans-serif;
            color: #222;
        }
        
        /* [ìˆ˜ì •] ìš”ë¯¸ê°€ë‚˜ (ìœ„ìª½, í¬ê²Œ) */
        #wp-hanja-game-wrapper .yomi-text {
            font-size: 1.8rem; /* í¬ê¸° í™•ëŒ€ */
            color: #d35400;    /* ì£¼í™©ìƒ‰ ê°•ì¡° */
            font-weight: 800;  /* êµµê²Œ */
            margin-bottom: 4px; /* ëœ»ê³¼ì˜ ê°„ê²© */
            font-family: sans-serif;
        }

        /* [ìˆ˜ì •] í•œêµ­ì–´ ëœ» (ì•„ë˜ìª½, ì‘ê²Œ) */
        #wp-hanja-game-wrapper .meaning-text {
            font-size: 1.4rem;   /* í¬ê¸° ì¶•ì†Œ */
            color: #555;       /* íšŒìƒ‰ì¡° */
            font-weight: 600;
        }

        #wp-hanja-game-wrapper .game-card:hover {
            border-color: #4a90e2;
            transform: translateY(-3px);
        }
        #wp-hanja-game-wrapper .game-card.selected {
            border-color: #4a90e2;
            background-color: #e3f2fd;
            box-shadow: 0 0 0 3px #4a90e2 inset;
        }
        #wp-hanja-game-wrapper .game-card.matched {
            border-color: transparent;
            background-color: #f5f5f5;
            color: #ccc;
            cursor: default;
            pointer-events: none;
            opacity: 0.6;
        }
        #wp-hanja-game-wrapper .game-card.matched .yomi-text,
        #wp-hanja-game-wrapper .game-card.matched .meaning-text { color: #ccc; }

        #wp-hanja-game-wrapper .game-card.wrong {
            background-color: #ffebee;
            border-color: #e74c3c;
            animation: wp-game-shake 0.4s;
        }
        #wp-hanja-game-wrapper .game-card.hint-highlight {
            background-color: #fff9c4 !important;
            border-color: #fbc02d !important;
            transform: scale(1.05);
            z-index: 20;
            box-shadow: 0 0 15px rgba(251, 192, 45, 0.6);
        }
        @keyframes wp-game-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ì½¤ë³´ ì´í™íŠ¸ */
        #wp-hanja-game-wrapper .combo-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(46, 204, 113, 0.95);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: bold;
            pointer-events: none;
            animation: fadeOutUp 1.2s forwards;
            z-index: 100;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        @keyframes fadeOutUp {
            0% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -100%); }
        }

        #wp-hanja-game-wrapper .btn-reset {
            display: block;
            margin: 25px auto 0;
            padding: 12px 35px;
            font-size: 1.1rem;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #wp-error-log { display: none; color: red; text-align: center; margin-top: 10px; }
        
        @media (max-width: 600px) {
            #wp-hanja-game-wrapper .game-board { flex-direction: column; }
        }
    </style>
</head>
<body style="background-color: #f4f6f8; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="wp-hanja-game-wrapper">
        <header>
            <h2 class="game-title">JLPT N2/N3 í…Œë§ˆë³„ í•œì ê²Œì„</h2>
            
            <div class="set-selector" id="wp-set-selector">
                <button class="btn-set active" data-set="1">Set 1: ëª¨ì–‘ ìœ ì‚¬</button>
                <button class="btn-set" data-set="2">Set 2: ë¶€ìˆ˜ ì°¨ì´</button>
                <button class="btn-set" data-set="3">Set 3: ë³µì¡/íšìˆ˜</button>
                <button class="btn-set" data-set="4">Set 4: ë™ìŒì´ì˜</button>
                <button class="btn-set" data-set="5">Set 5: í˜¼ë™ ì£¼ì˜</button>
                <button class="btn-set random-set" data-set="6">Set 6: ëœë¤ ë¯¹ìŠ¤</button>
            </div>

            <div class="status-bar">
                <span>â±ï¸ <b id="wp-timer">00:00</b></span>
                <span>ğŸ† <b id="wp-current-score" class="score-text">0</b> / 500</span>
                <span>ë‚¨ì€ ìŒ: <b id="wp-pairs-left">25</b></span>
            </div>
        </header>

        <div id="wp-error-log"></div>

        <div class="game-board">
            <div id="wp-overlay-area"></div>
            <div class="game-section">
                <div class="col-header">í•œì (Hanja)</div>
                <div id="wp-col-hanja" class="card-grid"></div>
            </div>
            <div class="game-section">
                <div class="col-header">ëœ» (Meaning)</div>
                <div id="wp-col-meaning" class="card-grid"></div>
            </div>
        </div>

        <button id="wp-btn-reset" class="btn-reset">ìƒˆë¡œìš´ ê²Œì„ ì‹œì‘</button>
    </div>

    <script>
    (function() {
        try {
            var gameData = [];
            var selectedMeaning = null;
            var selectedHanja = null;
            var pairsLeft = 0;
            var PAIRS_COUNT = 25; 
            
            var currentScore = 0;
            var MAX_SCORE = 500; 
            var lastCorrectTime = 0; 
            var gameTimer = null;
            var secondsElapsed = 0;
            
            var firstSelectionType = null; 
            var isStreakAlive = true; 
            var currentSetId = 1; // ê¸°ë³¸ ì„¸íŠ¸ 1

            // ==========================================
            // [ë°ì´í„°ë² ì´ìŠ¤] Set 1~5 (N2/N3 ìœ„ì£¼, N1 ì œì™¸)
            // ==========================================
            var sets = {
                1: [ // Set 1: ëª¨ì–‘ì´ 90% ì¼ì¹˜ (Shape)
                    {id:101, hanja:"å¾´", meaning:"ì§•í›„ ì§•", reading:"ã¡ã‚‡ã†"}, {id:102, hanja:"å¾®", meaning:"ì‘ì„ ë¯¸", reading:"ã³"},
                    {id:103, hanja:"æ‹¾", meaning:"ì¤ë‹¤ ìŠµ", reading:"ã²ã‚(ã†)"}, {id:104, hanja:"æ¨", meaning:"ë²„ë¦¬ë‹¤ ì‚¬", reading:"ã™(ã¦ã‚‹)"},
                    {id:105, hanja:"æŒ", meaning:"ê°€ì§€ë‹¤ ì§€", reading:"ã‚‚(ã¤)"}, {id:106, hanja:"å¾…", meaning:"ê¸°ë‹¤ë¦¬ë‹¤ ëŒ€", reading:"ã¾(ã¤)"},
                    {id:107, hanja:"æ¸¬", meaning:"ì¬ë‹¤ ì¸¡", reading:"ãã"}, {id:108, hanja:"å´", meaning:"ì¸¡ë©´ ì¸¡", reading:"ãŒã‚"},
                    {id:109, hanja:"ç·‘", meaning:"ë…¹ìƒ‰ ë¡", reading:"ã¿ã©ã‚Š"}, {id:110, hanja:"ç¸", meaning:"ì¸ì—° ì—°", reading:"ãˆã‚“"},
                    {id:111, hanja:"å½¼", meaning:"ê·¸ í”¼", reading:"ã‹ã‚Œ"}, {id:112, hanja:"æ³¢", meaning:"íŒŒë„ íŒŒ", reading:"ãªã¿"},
                    {id:113, hanja:"å¾’", meaning:"ë¬´ë¦¬ ë„", reading:"ã¨"}, {id:114, hanja:"å¾“", meaning:"ë”°ë¥´ë‹¤ ì¢…", reading:"ã˜ã‚…ã†"},
                    {id:115, hanja:"ç‰¹", meaning:"íŠ¹ë³„ íŠ¹", reading:"ã¨ã"}, {id:116, hanja:"æŒ", meaning:"ê°€ì§€ë‹¤ ì§€", reading:"ã‚‚(ã¤)"},
                    {id:117, hanja:"æœª", meaning:"ì•„ì§ ë¯¸", reading:"ã¿"}, {id:118, hanja:"æœ«", meaning:"ë ë§", reading:"ã¾ã¤"},
                    {id:119, hanja:"ç‰›", meaning:"ì†Œ ìš°", reading:"ã†ã—"}, {id:120, hanja:"åˆ", meaning:"ë‚® ì˜¤", reading:"ã”"},
                    {id:121, hanja:"çŸ³", meaning:"ëŒ ì„", reading:"ã„ã—"}, {id:122, hanja:"å³", meaning:"ì˜¤ë¥¸ ìš°", reading:"ã¿ã"},
                    {id:123, hanja:"åˆ€", meaning:"ì¹¼ ë„", reading:"ã‹ãŸãª"}, {id:124, hanja:"åˆƒ", meaning:"ì¹¼ë‚  ì¸", reading:"ã¯"},
                    {id:125, hanja:"åœŸ", meaning:"í™ í† ", reading:"ã¤ã¡"}, {id:126, hanja:"å£«", meaning:"ì„ ë¹„ ì‚¬", reading:"ã—"},
                    {id:127, hanja:"å­£", meaning:"ê³„ì ˆ ê³„", reading:"ã"}, {id:128, hanja:"å§”", meaning:"ë§¡ê¸¸ ìœ„", reading:"ã„"},
                    {id:129, hanja:"æ–™", meaning:"ì¬ë£Œ ë£Œ", reading:"ã‚Šã‚‡ã†"}, {id:130, hanja:"ç§‘", meaning:"ê³¼ëª© ê³¼", reading:"ã‹"}
                ],
                2: [ // Set 2: ë¶€ìˆ˜ ì°¨ì´ (Radical)
                    {id:201, hanja:"è£", meaning:"ì¬íŒ ì¬", reading:"ã•ã„"}, {id:202, hanja:"æ ½", meaning:"ì‹¬ì„ ì¬", reading:"ã•ã„"},
                    {id:203, hanja:"è¼‰", meaning:"ì‹¤ì„ ì¬", reading:"ã•ã„"}, {id:204, hanja:"è¡£", meaning:"ì˜· ì˜", reading:"ã“ã‚ã‚‚"},
                    {id:205, hanja:"ä¾", meaning:"ì˜ì§€í•  ì˜", reading:"ã„"}, {id:206, hanja:"æ™´", meaning:"ë§‘ì„ ì²­", reading:"ã¯(ã‚Œ)"},
                    {id:207, hanja:"æƒ…", meaning:"ëœ» ì •", reading:"ã˜ã‚‡ã†"}, {id:208, hanja:"æ¸…", meaning:"ë§‘ì„ ì²­", reading:"ãã‚ˆ(ã„)"},
                    {id:209, hanja:"ç²¾", meaning:"ì •ë°€ ì •", reading:"ã›ã„"}, {id:210, hanja:"è«‹", meaning:"ì²­í•  ì²­", reading:"ã›ã„"},
                    {id:211, hanja:"æ‹›", meaning:"ì´ˆëŒ€ ì´ˆ", reading:"ã¾ã­(ã)"}, {id:212, hanja:"æ˜­", meaning:"ë°ì„ ì†Œ", reading:"ã—ã‚‡ã†"},
                    {id:213, hanja:"ç…§", meaning:"ë¹„ì¶œ ì¡°", reading:"ã¦(ã‚‰ã™)"}, {id:214, hanja:"ç´¹", meaning:"ì´ì„ ì†Œ", reading:"ã—ã‚‡ã†"},
                    {id:215, hanja:"è¶…", meaning:"ë„˜ì„ ì´ˆ", reading:"ã¡ã‚‡ã†"}, {id:216, hanja:"è¶Š", meaning:"ë„˜ì„ ì›”", reading:"ã“(ã™)"},
                    {id:217, hanja:"æ¿", meaning:"íŒ íŒ", reading:"ã„ãŸ"}, {id:218, hanja:"ç‰ˆ", meaning:"ì¶œíŒ íŒ", reading:"ã¯ã‚“"},
                    {id:219, hanja:"è²©", meaning:"íŒ” íŒ", reading:"ã¯ã‚“"}, {id:220, hanja:"æ³³", meaning:"ìˆ˜ì˜ ì˜", reading:"ãŠã‚ˆ(ã)"},
                    {id:221, hanja:"æ°¸", meaning:"ê¸¸ ì˜", reading:"ãˆã„"}, {id:222, hanja:"æ°·", meaning:"ì–¼ìŒ ë¹™", reading:"ã“ãŠã‚Š"},
                    {id:223, hanja:"æŠ±", meaning:"ì•ˆì„ í¬", reading:"ã (ã)"}, {id:224, hanja:"æ³¡", meaning:"ê±°í’ˆ í¬", reading:"ã‚ã‚"},
                    {id:225, hanja:"èƒ", meaning:"ì„¸í¬ í¬", reading:"ã»ã†"}, {id:226, hanja:"ç ²", meaning:"ëŒ€í¬ í¬", reading:"ã»ã†"},
                    {id:227, hanja:"è¨ª", meaning:"ë°©ë¬¸ ë°©", reading:"ã»ã†"}, {id:228, hanja:"åŠ", meaning:"ë™ë„¤ ë°©", reading:"ã¼ã†"},
                    {id:229, hanja:"é˜²", meaning:"ë§‰ì„ ë°©", reading:"ã¼ã†"}, {id:230, hanja:"æ”¾", meaning:"ë†“ì„ ë°©", reading:"ã¯ãª(ã™)"}
                ],
                3: [ // Set 3: ë³µì¡/íšìˆ˜ (Complex)
                    {id:301, hanja:"è§¦", meaning:"ë‹¿ì„ ì´‰", reading:"ãµ(ã‚Œã‚‹)"}, {id:302, hanja:"è§£", meaning:"í’€ í•´", reading:"ã‹ã„"},
                    {id:303, hanja:"è­¦", meaning:"ê²½ê³„ ê²½", reading:"ã‘ã„"}, {id:304, hanja:"é©š", meaning:"ë†€ë„ ê²½", reading:"ãŠã©ã‚(ã)"},
                    {id:305, hanja:"è·", meaning:"ì§ì—… ì§", reading:"ã—ã‚‡ã"}, {id:306, hanja:"è­˜", meaning:"ì•Œ ì‹", reading:"ã—ã"},
                    {id:307, hanja:"ç¹”", meaning:"ì§¤ ì§", reading:"ãŠ(ã‚‹)"}, {id:308, hanja:"è‡“", meaning:"ë‚´ì¥ ì¥", reading:"ãã†"},
                    {id:309, hanja:"è”µ", meaning:"ì°½ê³  ì¥", reading:"ãã‚‰"}, {id:310, hanja:"è£…", meaning:"ê¾¸ë°€ ì¥", reading:"ãã†"},
                    {id:311, hanja:"å³", meaning:"ì—„í•  ì—„", reading:"ã’ã‚“"}, {id:312, hanja:"ç¯„", meaning:"ë²• ë²”", reading:"ã¯ã‚“"},
                    {id:313, hanja:"ç¾©", meaning:"ì˜³ì„ ì˜", reading:"ã"}, {id:314, hanja:"å„€", meaning:"ê±°ë™ ì˜", reading:"ã"},
                    {id:315, hanja:"è­°", meaning:"ì˜ë…¼ ì˜", reading:"ã"}, {id:316, hanja:"çŠ ", meaning:"í¬ìƒ í¬", reading:"ã"},
                    {id:317, hanja:"æ¨©", meaning:"ê¶Œì„¸ ê¶Œ", reading:"ã‘ã‚“"}, {id:318, hanja:"è¦³", meaning:"ë³¼ ê´€", reading:"ã‹ã‚“"},
                    {id:319, hanja:"æ­“", meaning:"ê¸°ì  í™˜", reading:"ã‹ã‚“"}, {id:320, hanja:"å‹§", meaning:"ê¶Œí•  ê¶Œ", reading:"ã‹ã‚“"},
                    {id:321, hanja:"ç¢º", meaning:"êµ³ì„ í™•", reading:"ã‹ã"}, {id:322, hanja:"èª", meaning:"ì¸ì • ì¸", reading:"ã«ã‚“"},
                    {id:323, hanja:"ç¶­", meaning:"ìœ ì§€ ìœ ", reading:"ã„"}, {id:324, hanja:"å”¯", meaning:"ì˜¤ì§ ìœ ", reading:"ã‚†ã„"},
                    {id:325, hanja:"é›‘", meaning:"ì„ì¼ ì¡", reading:"ã–ã¤"}, {id:326, hanja:"é›¢", meaning:"ë– ë‚  ë¦¬", reading:"ã‚Š"},
                    {id:327, hanja:"é›£", meaning:"ì–´ë ¤ìš¸ ë‚œ", reading:"ãªã‚“"}, {id:328, hanja:"å‹¤", meaning:"ê·¼ë¬´ ê·¼", reading:"ãã‚“"},
                    {id:329, hanja:"åŠ‡", meaning:"ì‹¬í•  ê·¹", reading:"ã’ã"}, {id:330, hanja:"æ¿€", meaning:"ê²©í•  ê²©", reading:"ã’ã"}
                ],
                4: [ // Set 4: ë™ìŒì´ì˜ì–´ (Homophones - Japanese focus)
                    {id:401, hanja:"å‚", meaning:"ì–¸ë• íŒ", reading:"ã•ã‹"}, {id:402, hanja:"é…’", meaning:"ìˆ  ì£¼", reading:"ã•ã‘"},
                    {id:403, hanja:"æ¿", meaning:"ë„íŒì§€ íŒ", reading:"ã„ãŸ"}, {id:404, hanja:"ç‰ˆ", meaning:"íŒ íŒ", reading:"ã¯ã‚“"},
                    {id:405, hanja:"ä¼š", meaning:"ë§Œë‚  íšŒ", reading:"ã‹ã„"}, {id:406, hanja:"å›", meaning:"ëŒ íšŒ", reading:"ã‹ã„"},
                    {id:407, hanja:"æ”¹", meaning:"ê³ ì¹  ê°œ", reading:"ã‹ã„"}, {id:408, hanja:"è§£", meaning:"í’€ í•´", reading:"ã‹ã„"},
                    {id:409, hanja:"éš", meaning:"ì¸µ ê³„", reading:"ã‹ã„"}, {id:410, hanja:"æ¢°", meaning:"ê¸°ê³„ ê³„", reading:"ã‹ã„"},
                    {id:411, hanja:"å¿«", meaning:"ì¾Œí•  ì¾Œ", reading:"ã‹ã„"}, {id:412, hanja:"æ€ª", meaning:"ê´´ì´ ê´´", reading:"ã‹ã„"},
                    {id:413, hanja:"äº‹", meaning:"ì¼ ì‚¬", reading:"ã˜"}, {id:414, hanja:"è‡ª", meaning:"ìŠ¤ìŠ¤ë¡œ ì", reading:"ã˜"},
                    {id:415, hanja:"æ¬¡", meaning:"ë‹¤ìŒ ì°¨", reading:"ã˜"}, {id:416, hanja:"æ²»", meaning:"ë‹¤ìŠ¤ë¦´ ì¹˜", reading:"ã˜"},
                    {id:417, hanja:"æ™‚", meaning:"ë•Œ ì‹œ", reading:"ã˜"}, {id:418, hanja:"è¾", meaning:"ë§ì”€ ì‚¬", reading:"ã˜"},
                    {id:419, hanja:"ç†±", meaning:"ëœ¨ê±°ìš¸ ì—´", reading:"ã‚ã¤(ã„)"}, {id:420, hanja:"åš", meaning:"ë‘í„°ìš¸ í›„", reading:"ã‚ã¤(ã„)"},
                    {id:421, hanja:"æš‘", meaning:"ë”ìš¸ ì„œ", reading:"ã‚ã¤(ã„)"}, {id:422, hanja:"ç¯¤", meaning:"ë…ì‹¤ ë…", reading:"ã‚ã¤(ã„)"},
                    {id:423, hanja:"æ—©", meaning:"ì´ë¥¼ ì¡°", reading:"ã¯ã‚„(ã„)"}, {id:424, hanja:"é€Ÿ", meaning:"ë¹ ë¥¼ ì†", reading:"ã¯ã‚„(ã„)"},
                    {id:425, hanja:"ç§»", meaning:"ì˜®ê¸¸ ì´", reading:"ã†ã¤(ã‚‹)"}, {id:426, hanja:"å†™", meaning:"ë² ë‚„ ì‚¬", reading:"ã†ã¤(ã‚‹)"},
                    {id:427, hanja:"æ˜ ", meaning:"ë¹„ì¹  ì˜", reading:"ã†ã¤(ã‚‹)"}, {id:428, hanja:"å†…", meaning:"ì•ˆ ë‚´", reading:"ã†ã¡"},
                    {id:429, hanja:"æ‰“", meaning:"ì¹  íƒ€", reading:"ã†(ã¤)"}, {id:430, hanja:"è¨", meaning:"í† ë²Œ í† ", reading:"ã†(ã¤)"}
                ],
                5: [ // Set 5: ì‹¤ìƒí™œ í˜¼ë™ (Common Mistakes)
                    {id:501, hanja:"ç¶²", meaning:"ê·¸ë¬¼ ë§", reading:"ã‚ã¿"}, {id:502, hanja:"ç¶±", meaning:"ë²¼ë¦¬ ê°•", reading:"ã¤ãª"},
                    {id:503, hanja:"éš›", meaning:"ì¦ˆìŒ ì œ", reading:"ã•ã„"}, {id:504, hanja:"ç¥­", meaning:"ì¶•ì œ ì œ", reading:"ã¾ã¤(ã‚Š)"},
                    {id:505, hanja:"æ¸ˆ", meaning:"ê±´ë„ ì œ", reading:"ã™(ã‚€)"}, {id:506, hanja:"å‰¤", meaning:"ì•½ì œ ì œ", reading:"ã–ã„"},
                    {id:507, hanja:"å„ª", meaning:"ë›°ì–´ë‚  ìš°", reading:"ã‚„ã•(ã—ã„)"}, {id:508, hanja:"æ˜“", meaning:"ì‰¬ìš¸ ì´", reading:"ã‚„ã•(ã—ã„)"},
                    {id:509, hanja:"çµ¶", meaning:"ëŠì„ ì ˆ", reading:"ãœã¤"}, {id:510, hanja:"çµ±", meaning:"ê±°ëŠë¦´ í†µ", reading:"ã¨ã†"},
                    {id:511, hanja:"ç¶¿", meaning:"ì†œ ë©´", reading:"ã‚ã‚“"}, {id:512, hanja:"çµ¹", meaning:"ë¹„ë‹¨ ê²¬", reading:"ãã¬"},
                    {id:513, hanja:"ç·š", meaning:"ì¤„ ì„ ", reading:"ã›ã‚“"}, {id:514, hanja:"ç·‘", meaning:"ë…¹ìƒ‰ ë¡", reading:"ã¿ã©ã‚Š"},
                    {id:515, hanja:"ç·´", meaning:"ìµí ë ¨", reading:"ã‚Œã‚“"}, {id:516, hanja:"ç·’", meaning:"ì‹¤ë§ˆë¦¬ ì„œ", reading:"ã—ã‚‡"},
                    {id:517, hanja:"è«¸", meaning:"ëª¨ë‘ ì œ", reading:"ã—ã‚‡"}, {id:518, hanja:"ç½²", meaning:"ê´€ì²­ ì„œ", reading:"ã—ã‚‡"},
                    {id:519, hanja:"è‘—", meaning:"ì €ìˆ  ì €", reading:"ã¡ã‚‡"}, {id:520, hanja:"ç€", meaning:"ì…ì„ ì°©", reading:"ã(ã‚‹)"},
                    {id:521, hanja:"åŸº", meaning:"í„° ê¸°", reading:"ã"}, {id:522, hanja:"å¢“", meaning:"ë¬´ë¤ ë¬˜", reading:"ã¯ã‹"},
                    {id:523, hanja:"å¹•", meaning:"ë§‰ ë§‰", reading:"ã¾ã"}, {id:524, hanja:"æš®", meaning:"ì €ë¬¼ ëª¨", reading:"ã(ã‚Œã‚‹)"},
                    {id:525, hanja:"å‹Ÿ", meaning:"ëª¨ì„ ëª¨", reading:"ã¼"}, {id:526, hanja:"æ…•", meaning:"ê·¸ë¦¬ìš¸ ëª¨", reading:"ã¼"},
                    {id:527, hanja:"åˆ¸", meaning:"ë¬¸ì„œ ê¶Œ", reading:"ã‘ã‚“"}, {id:528, hanja:"å·»", meaning:"ì±… ê¶Œ", reading:"ã‹ã‚“"},
                    {id:529, hanja:"æš´", meaning:"ì‚¬ë‚˜ìš¸ í­", reading:"ã¼ã†"}, {id:530, hanja:"çˆ†", meaning:"í„°ì§ˆ í­", reading:"ã°ã"}
                ]
            };

            var colMeaning = document.getElementById('wp-col-meaning');
            var colHanja = document.getElementById('wp-col-hanja');
            var pairsLeftEl = document.getElementById('wp-pairs-left');
            var timerEl = document.getElementById('wp-timer');
            var scoreEl = document.getElementById('wp-current-score');
            var overlayArea = document.getElementById('wp-overlay-area');
            var resetBtn = document.getElementById('wp-btn-reset');
            var errorLog = document.getElementById('wp-error-log');
            var setSelector = document.getElementById('wp-set-selector');

            // ì„¸íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            if(setSelector) {
                setSelector.addEventListener('click', function(e) {
                    if(e.target.classList.contains('btn-set')) {
                        var selectedSet = parseInt(e.target.dataset.set);
                        // ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼ ë³€ê²½
                        var buttons = setSelector.querySelectorAll('.btn-set');
                        buttons.forEach(function(btn){ btn.classList.remove('active'); });
                        e.target.classList.add('active');
                        
                        // ê²Œì„ ì‹œì‘
                        currentSetId = selectedSet;
                        initGame(currentSetId);
                    }
                });
            }

            if(resetBtn) {
                resetBtn.addEventListener('click', function() {
                    initGame(currentSetId);
                });
            }

            function shuffle(array) {
                for (var i = array.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
                return array;
            }

            function formatTime(sec) {
                var m = Math.floor(sec / 60).toString().padStart(2, '0');
                var s = (sec % 60).toString().padStart(2, '0');
                return m + ':' + s;
            }

            function startTimer() {
                stopTimer();
                secondsElapsed = 0;
                if(timerEl) timerEl.textContent = "00:00";
                gameTimer = setInterval(function() {
                    secondsElapsed++;
                    if(timerEl) timerEl.textContent = formatTime(secondsElapsed);
                }, 1000);
            }

            function stopTimer() {
                if(gameTimer) clearInterval(gameTimer);
            }

            function initGame(setId) {
                try {
                    stopTimer();
                    
                    // ë°ì´í„° ì„ íƒ
                    var selectedData = [];
                    if(setId === 6) {
                        // Set 6: ì „ì²´ ë¯¹ìŠ¤
                        for(var key in sets) {
                            selectedData = selectedData.concat(sets[key]);
                        }
                    } else {
                        selectedData = sets[setId] ? sets[setId] : sets[1];
                    }

                    // ë°ì´í„° ì…”í”Œ í›„ 25ê°œ ì¶”ì¶œ
                    var shuffledFull = shuffle(JSON.parse(JSON.stringify(selectedData)));
                    
                    // ë°ì´í„°ê°€ 25ê°œë³´ë‹¤ ì ìœ¼ë©´ ìˆëŠ” ë§Œí¼ë§Œ, ë§ìœ¼ë©´ 25ê°œ ìë¥´ê¸°
                    var sliceCount = shuffledFull.length < PAIRS_COUNT ? shuffledFull.length : PAIRS_COUNT;
                    gameData = shuffledFull.slice(0, sliceCount);

                    pairsLeft = sliceCount;
                    currentScore = 0;
                    selectedMeaning = null;
                    selectedHanja = null;
                    firstSelectionType = null;
                    lastCorrectTime = Date.now();
                    isStreakAlive = true;

                    if(pairsLeftEl) pairsLeftEl.textContent = pairsLeft;
                    if(scoreEl) scoreEl.textContent = currentScore;
                    
                    startTimer();
                    renderBoard();
                } catch(e) {
                    if(errorLog) {
                        errorLog.style.display = 'block';
                        errorLog.textContent = "ì´ˆê¸°í™” ì—ëŸ¬: " + e.message;
                    }
                }
            }

            function renderBoard() {
                if(!colMeaning || !colHanja) return;

                colMeaning.innerHTML = '';
                colHanja.innerHTML = '';

                var hanjaList = JSON.parse(JSON.stringify(gameData));
                shuffle(hanjaList);
                hanjaList.forEach(function(item) {
                    var card = document.createElement('div');
                    card.className = 'game-card hanja';
                    card.textContent = item.hanja;
                    card.dataset.id = item.id;
                    card.dataset.type = 'hanja';
                    card.addEventListener('click', handleCardClick);
                    colHanja.appendChild(card);
                });

                var meaningList = JSON.parse(JSON.stringify(gameData));
                shuffle(meaningList);
                meaningList.forEach(function(item) {
                    var card = document.createElement('div');
                    card.className = 'game-card meaning-card';
                    
                    // ìš”ë¯¸ê°€ë‚˜(reading)ì„ ë¨¼ì € ìƒì„±í•´ì„œ ìœ„ì— ë°°ì¹˜
                    var yomiDiv = document.createElement('div');
                    yomiDiv.className = 'yomi-text';
                    yomiDiv.textContent = item.reading;

                    var meaningSpan = document.createElement('span');
                    meaningSpan.className = 'meaning-text'; 
                    meaningSpan.textContent = item.meaning;
                    
                    // ìš”ë¯¸ê°€ë‚˜ ë¨¼ì €, ëœ»ì€ ë‚˜ì¤‘ì— (ìœ„ -> ì•„ë˜ ìˆœì„œ)
                    card.appendChild(yomiDiv);
                    card.appendChild(meaningSpan);

                    card.dataset.id = item.id;
                    card.dataset.type = 'meaning';
                    card.addEventListener('click', handleCardClick);
                    colMeaning.appendChild(card);
                });
            }

            function handleCardClick(e) {
                var clickedCard = e.currentTarget;

                if (clickedCard.classList.contains('matched') || clickedCard.classList.contains('selected')) {
                    return;
                }

                var type = clickedCard.dataset.type;

                if (!selectedMeaning && !selectedHanja) {
                    firstSelectionType = type;
                } 
                else if ( (type === 'meaning' && selectedMeaning) || (type === 'hanja' && selectedHanja) ) {
                    firstSelectionType = type;
                }

                if (type === 'meaning') {
                    if (selectedMeaning) selectedMeaning.classList.remove('selected');
                    selectedMeaning = clickedCard;
                    selectedMeaning.classList.add('selected');
                } else {
                    if (selectedHanja) selectedHanja.classList.remove('selected');
                    selectedHanja = clickedCard;
                    selectedHanja.classList.add('selected');
                }

                if (selectedMeaning && selectedHanja) {
                    checkMatch();
                }
            }

            function checkMatch() {
                var meaningId = selectedMeaning.dataset.id;
                var hanjaId = selectedHanja.dataset.id;

                if (meaningId === hanjaId) {
                    handleCorrect();
                } else {
                    handleWrong();
                }
            }

            function handleCorrect() {
                var now = Date.now();
                var timeDiff = now - lastCorrectTime;
                
                var pointsToAdd = 10;
                var isCombo = false;

                // [ë¡œì§] ìŠ¤íŠ¸ë¦­ì´ ì‚´ì•„ìˆê³  + 5ì´ˆ ì´ë‚´ì—¬ì•¼ ë³´ë„ˆìŠ¤
                if (isStreakAlive === true) {
                    pointsToAdd += 5; // ê¸°ë³¸ ìŠ¤íŠ¸ë¦­ ë³´ë„ˆìŠ¤
                    
                    // 5ì´ˆ ë£° ì ìš©
                    if (timeDiff < 5000) { 
                        pointsToAdd += 5; // ìŠ¤í”¼ë“œ ë³´ë„ˆìŠ¤
                        isCombo = true;
                    }
                } else {
                    // ìŠ¤íŠ¸ë¦­ì´ ê¹¨ì§„ ìƒíƒœë©´ ë³´ë„ˆìŠ¤ ì—†ìŒ (10ì ë§Œ)
                    isCombo = false;
                }

                currentScore += pointsToAdd;
                if(scoreEl) scoreEl.textContent = currentScore;
                
                lastCorrectTime = now;
                // ì •ë‹µ ë§ì·„ìœ¼ë‹ˆ ë‹¤ìŒì—” ë‹¤ì‹œ ê¸°íšŒ ì¤Œ
                isStreakAlive = true;

                selectedMeaning.classList.remove('selected');
                selectedHanja.classList.remove('selected');
                
                selectedMeaning.classList.add('matched');
                selectedHanja.classList.add('matched');

                // 10ì  ì´ˆê³¼ ì‹œ(ë³´ë„ˆìŠ¤ ìˆì„ ë•Œ)ë§Œ íš¨ê³¼
                if (pointsToAdd > 10) {
                    showComboEffect("Combo! +" + pointsToAdd);
                }

                selectedMeaning = null;
                selectedHanja = null;
                firstSelectionType = null;

                pairsLeft--;
                if(pairsLeftEl) pairsLeftEl.textContent = pairsLeft;

                if (pairsLeft === 0) {
                    stopTimer();
                    setTimeout(function() {
                        alert('ê²Œì„ ì¢…ë£Œ! ìµœì¢… ì ìˆ˜: ' + currentScore + ' / ' + MAX_SCORE);
                    }, 300);
                }
            }

            function handleWrong() {
                // [ë¡œì§] í‹€ë¦¬ë©´ ìŠ¤íŠ¸ë¦­ ê¹¨ì§
                isStreakAlive = false;

                var cardToShake = null;
                if (firstSelectionType === 'hanja') {
                    cardToShake = selectedMeaning;
                } else if (firstSelectionType === 'meaning') {
                    cardToShake = selectedHanja;
                }

                if (cardToShake) {
                    cardToShake.classList.add('wrong');
                } else {
                    if(selectedMeaning) selectedMeaning.classList.add('wrong');
                    if(selectedHanja) selectedHanja.classList.add('wrong');
                }

                var hintCard = null;
                if (firstSelectionType === 'hanja' && selectedHanja) {
                    hintCard = document.querySelector('#wp-col-meaning .game-card[data-id="' + selectedHanja.dataset.id + '"]');
                } else if (firstSelectionType === 'meaning' && selectedMeaning) {
                    hintCard = document.querySelector('#wp-col-hanja .game-card[data-id="' + selectedMeaning.dataset.id + '"]');
                }

                if (hintCard) {
                    hintCard.classList.add('hint-highlight');
                }

                setTimeout(function() {
                    if (selectedMeaning) {
                        selectedMeaning.classList.remove('selected', 'wrong');
                        selectedMeaning = null;
                    }
                    if (selectedHanja) {
                        selectedHanja.classList.remove('selected', 'wrong');
                        selectedHanja = null;
                    }
                    if (hintCard) {
                        hintCard.classList.remove('hint-highlight');
                    }
                    firstSelectionType = null;
                }, 800);
            }

            function showComboEffect(text) {
                if(!overlayArea) return;
                var msg = document.createElement('div');
                msg.className = 'combo-msg';
                msg.textContent = text;
                overlayArea.appendChild(msg);

                setTimeout(function() {
                    msg.remove();
                }, 1200);
            }

            // ì•ˆì „í•˜ê²Œ ì‹¤í–‰
            setTimeout(function() { initGame(1); }, 300);

        } catch (e) {
            if(document.getElementById('wp-error-log')) {
                document.getElementById('wp-error-log').style.display = 'block';
                document.getElementById('wp-error-log').textContent = "ì‹¤í–‰ ì˜¤ë¥˜: " + e.message;
            }
        }
    })();
    </script>
</body>
</html>
