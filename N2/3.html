<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N2 ì‹¤ì „ ë¬¸ì¥ ì™„ì„± ê²Œì„</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #ef4444; 
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Pretendard', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #b91c1c; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #fef2f2; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* N2 3íƒ„ ìµœì¢…: ì ìˆ˜ ì´í™íŠ¸ ì¶”ê°€ (Pop-up Score) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&family=Pretendard:wght@500;800&display=swap');

        body { background-color: #fef2f2; margin: 0; padding: 0; }

        .game-wrapper {
            font-family: 'Pretendard', 'Noto Sans JP', sans-serif;
            max-width: 800px;
            margin: 0 auto 30px auto;
            text-align: center;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 4px solid #ef4444;
            overflow: hidden;
            transition: height 0.3s;
            position: relative; /* íŒì—… ìœ„ì¹˜ ê¸°ì¤€ */
        }

        /* ìƒë‹¨ íƒ­ */
        .stage-tabs {
            display: flex;
            background: #fef2f2;
            border-bottom: 2px solid #ef4444;
        }
        .tab-btn {
            flex: 1; padding: 15px; font-weight: 800; cursor: pointer;
            color: #7f1d1d; font-size: 1.3rem; transition: 0.3s; border: none; background: transparent;
        }
        .tab-btn.active { background: #ef4444; color: white; }
        .tab-btn:hover:not(.active) { background: #fee2e2; }

        /* ì •ë³´ì°½ */
        .info-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 30px; background: #fff; border-bottom: 1px solid #fee2e2;
            flex-wrap: wrap; gap: 15px;
        }
        .toggle-container { display: flex; align-items: center; gap: 10px; font-weight: bold; color: #555; font-size: 1.2rem; }
        
        .timer-display { 
            font-family: 'Pretendard', sans-serif; font-weight: 900; color: #ef4444; 
            padding: 8px 20px; border: 3px solid #ef4444; border-radius: 50px; 
            min-width: 100px; display: inline-flex; justify-content: center; align-items: center; 
            gap: 5px; font-size: 1.4rem; box-shadow: 0 4px 0 rgba(239, 68, 68, 0.2);
        }

        /* ìš°ì¸¡ ìƒíƒœ ê·¸ë£¹ (ë¬¸ì œìˆ˜ + ì ìˆ˜) */
        .status-group {
            display: flex; gap: 20px; align-items: center;
        }
        .status-text { font-size: 1.6rem; font-weight: 800; color: #991b1b; }

        /* ìŠ¤ìœ„ì¹˜ UI */
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: "æ¼¢"; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: #555; font-family: 'Noto Sans JP'; }
        input:checked + .slider { background-color: #10b981; } 
        input:checked + .slider:before { transform: translateX(26px); content: "ã‚"; color: #10b981; }

        /* ë©”ì¸ ê²Œì„ ë°”ë”” */
        .game-body { padding: 20px 30px 30px; position: relative; }

        .progress-bar-container { width: 100%; height: 12px; background: #eee; border-radius: 6px; margin-bottom: 25px; overflow: hidden; }
        .progress-fill { height: 100%; background: #ef4444; width: 0%; transition: width 0.3s; }

        /* ì •ë‹µ ìŠ¬ë¡¯ */
        .answer-zone {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
            min-height: 120px; 
            background: #fff1f2; border: 3px dashed #fca5a5; border-radius: 15px;
            padding: 20px; margin-bottom: 20px; align-items: center;
        }
        .slot {
            border-bottom: 3px solid #ccc; min-width: 90px; min-height: 80px; 
            padding: 5px 15px; background: white; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .slot.filled { border-bottom: 3px solid #ef4444; color: #ef4444; background-color: #fff; }

        /* ë£¨ë¹„ ìŠ¤íƒ€ì¼ (í° ê¸€ì”¨) */
        .ruby-box { display: flex; flex-direction: column; align-items: center; line-height: 1.2; }
        .ruby-yomi { font-size: 1.2rem; color: #10b981; margin-bottom: 0px; font-weight: bold; }
        .ruby-text { font-size: 2.2rem; font-weight: bold; }
        
        .word-btn .ruby-text { font-size: 2.0rem; } 
        .word-btn .ruby-yomi { font-size: 1.1rem; }

        /* ë©”ì‹œì§€ ì˜ì—­ */
        .message-zone {
            min-height: 100px; margin-bottom: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            line-height: 1.4;
        }
        .hint-text { 
            margin-top: 10px; color: #7f1d1d; font-size: 1.6rem; font-weight: 800;
            background-color: #fef2f2; padding: 15px 30px; border-radius: 15px; word-break: keep-all;
        }

        /* ë‹¨ì–´ ë²„íŠ¼ (ì˜µì…˜ ì˜ì—­) */
        .options-zone {
            display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; align-content: center;
            padding: 10px 0 20px;
            min-height: 100px;
        }
        .word-btn {
            padding: 10px 25px; min-height: 85px; 
            background: white; color: #991b1b; border: 3px solid #991b1b; border-radius: 12px;
            cursor: pointer; box-shadow: 0 4px 0 #7f1d1d; transition: transform 0.1s, box-shadow 0.1s;
            display: flex; align-items: center; justify-content: center;
        }
        .word-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #7f1d1d; }
        .word-btn.hidden { visibility: hidden; pointer-events: none; }

        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .controls-zone { margin-top: 10px; display: flex; gap: 15px; justify-content: center; } 
        .action-btn {
            padding: 15px 40px; font-size: 1.5rem; font-weight: 800;
            border: none; border-radius: 50px; cursor: pointer;
            display: none; align-items: center; gap: 10px;
            transition: 0.2s; box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .btn-audio { background: #3b82f6; color: white; box-shadow: 0 4px 0 #1d4ed8; }
        .btn-audio:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-next { background: #ef4444; color: white; box-shadow: 0 4px 0 #b91c1c; }
        .btn-next:hover { background: #dc2626; transform: translateY(-2px); }

        /* ì ìˆ˜ íŒì—… ì• ë‹ˆë©”ì´ì…˜ */
        .score-popup {
            position: absolute;
            top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Pretendard', sans-serif;
            font-weight: 900;
            text-align: center;
            pointer-events: none; /* í´ë¦­ ë°©í•´ ê¸ˆì§€ */
            z-index: 100;
            opacity: 0;
            animation: popUpFloat 1.2s ease-out forwards;
        }

        @keyframes popUpFloat {
            0% { opacity: 0; transform: translate(-50%, 0) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50px) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -150px) scale(1); }
        }

        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-2px, 0, 0); } 
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); } 
            40%, 60% { transform: translate3d(6px, 0, 0); } 
        }

        @media (max-width: 600px) {
            .slot { min-width: 50px; padding: 2px 5px; min-height: 60px; }
            .ruby-text { font-size: 1.6rem; }
            .ruby-yomi { font-size: 0.9rem; }
            .word-btn { padding: 5px 10px; min-height: 65px; }
            .word-btn .ruby-text { font-size: 1.4rem; }
            .info-header { padding: 10px; font-size: 0.9rem; justify-content: center; gap: 10px; }
            .status-group { gap: 10px; width: 100%; justify-content: center; margin-top: 5px; }
            .hint-text { font-size: 1.3rem; padding: 10px 15px; }
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div class="game-wrapper">
        <div class="stage-tabs">
            <button class="tab-btn active" onclick="setStage(1)">1ë‹¨ê³„ (ê¸°ì´ˆ N2)</button>
            <button class="tab-btn" onclick="setStage(2)">2ë‹¨ê³„ (ì‘ìš© N2)</button>
            <button class="tab-btn" onclick="setStage(3)">3ë‹¨ê³„ (ì‹¤ì „ N2)</button>
        </div>

        <div class="info-header">
            <div class="toggle-container">
                <span>ìš”ë¯¸ê°€ë‚˜</span>
                <label class="switch">
                    <input type="checkbox" id="yomi-toggle" onchange="toggleYomigana()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="timer-display">0.00</div>
            
            <div class="status-group">
                <div class="status-text">ë¬¸ì œ: <span id="q-current">1</span> / 10</div>
                <div class="status-text" style="border-left: 2px solid #fee2e2; padding-left: 20px;">ì ìˆ˜: <span id="current-score">0</span> / <span id="max-score">0</span></div>
            </div>
        </div>

        <div class="game-body" id="game-body">
            <div class="progress-bar-container"><div class="progress-fill" id="progress-bar"></div></div>

            <div class="answer-zone" id="answer-zone"></div>

            <div class="message-zone" id="message-box">
                <span>ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!</span>
            </div>

            <div class="options-zone" id="options-zone"></div>

            <div class="controls-zone">
                <button class="action-btn btn-audio" id="btn-audio" onclick="playTTS()">ğŸ”Š ë¬¸ì¥ ë“£ê¸°</button>
                <button class="action-btn btn-next" id="btn-next" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¡</button>
            </div>
        </div>
    </div>

    <script>
        // --- N2ê¸‰ ë¬¸ì¥ ë°ì´í„° 40ê°œ ---
        const rawData = [
            // [1ë‹¨ê³„] ê¸°ì´ˆ N2
            { lvl: 1, ja: ["ã“ã®", "è–¬ã‚’", "é£²ã¾ã–ã‚‹ã‚’", "å¾—ãªã„"], yomi: ["ã“ã®", "ãã™ã‚Šã‚’", "ã®ã¾ã–ã‚‹ã‚’", "ãˆãªã„"], ko: "ì´ ì•½ì„ ë¨¹ì§€ ì•Šì„ ìˆ˜ ì—†ë‹¤ (ã€œã–ã‚‹ã‚’å¾—ãªã„)" },
            { lvl: 1, ja: ["åˆæ ¼", "ã—ãŸ", "ã“ã¨ã‚’", "çŸ¥ã‚‰ãªã‹ã£ãŸ"], yomi: ["ã”ã†ã‹ã", "ã—ãŸ", "ã“ã¨ã‚’", "ã—ã‚‰ãªã‹ã£ãŸ"], ko: "í•©ê²©í–ˆë‹¤ëŠ” ê²ƒì„ ëª°ëë‹¤" },
            { lvl: 1, ja: ["å½¼ã¯", "åŒ»è€…", "ã¨ã„ã†ã‚ˆã‚Š", "å­¦è€…ã "], yomi: ["ã‹ã‚Œã¯", "ã„ã—ã‚ƒ", "ã¨ã„ã†ã‚ˆã‚Š", "ãŒãã—ã‚ƒã "], ko: "ê·¸ëŠ” ì˜ì‚¬ë¼ê¸°ë³´ë‹¤ëŠ” í•™ìë‹¤ (ã€œã¨ã„ã†ã‚ˆã‚Š)" },
            { lvl: 1, ja: ["é›¨ãŒ", "é™ã£ã¦", "ã„ã‚‹", "æœ€ä¸­ã "], yomi: ["ã‚ã‚ãŒ", "ãµã£ã¦", "ã„ã‚‹", "ã•ã„ã¡ã‚…ã†ã "], ko: "ë¹„ê°€ ë‚´ë¦¬ê³  ìˆëŠ” ì¤‘ì´ë‹¤ (ã€œæœ€ä¸­ã )" },
            { lvl: 1, ja: ["ã‚‚ã£ã¨", "æ—©ã", "æ¥ã‚Œã°", "ã‚ˆã‹ã£ãŸ"], yomi: ["ã‚‚ã£ã¨", "ã¯ã‚„ã", "ãã‚Œã°", "ã‚ˆã‹ã£ãŸ"], ko: "ì¢€ ë” ë¹¨ë¦¬ ì™”ìœ¼ë©´ ì¢‹ì•˜ì„ í…ë°" },
            { lvl: 1, ja: ["æ—¥æœ¬ã¸", "ç•™å­¦", "ã™ã‚‹", "ã“ã¨ã«ã—ãŸ"], yomi: ["ã«ã»ã‚“ã¸", "ã‚Šã‚…ã†ãŒã", "ã™ã‚‹", "ã“ã¨ã«ã—ãŸ"], ko: "ì¼ë³¸ìœ¼ë¡œ ìœ í•™í•˜ê¸°ë¡œ í–ˆë‹¤ (ã€œã“ã¨ã«ã™ã‚‹)" },
            { lvl: 1, ja: ["ã“ã‚Œã¯", "ç§ã«", "ã¨ã£ã¦", "é‡è¦ã "], yomi: ["ã“ã‚Œã¯", "ã‚ãŸã—ã«", "ã¨ã£ã¦", "ã˜ã‚…ã†ã‚ˆã†ã "], ko: "ì´ê²ƒì€ ë‚˜ì—ê²Œ ìˆì–´ì„œ ì¤‘ìš”í•˜ë‹¤ (ã€œã«ã¨ã£ã¦)" },
            { lvl: 1, ja: ["ã‚ã®", "äººã¯", "æ¥ã‚‹ã«", "æ±ºã¾ã£ã¦ã„ã‚‹"], yomi: ["ã‚ã®", "ã²ã¨ã¯", "ãã‚‹ã«", "ãã¾ã£ã¦ã„ã‚‹"], ko: "ì € ì‚¬ëŒì€ ì˜¬ ê²Œ ë»”í•˜ë‹¤ (ã€œã«æ±ºã¾ã£ã¦ã„ã‚‹)" },
            { lvl: 1, ja: ["èª¬æ˜ã‚’", "èã„ã¦", "ã‹ã‚‰ã§", "ãªã„ã¨"], yomi: ["ã›ã¤ã‚ã„ã‚’", "ãã„ã¦", "ã‹ã‚‰ã§", "ãªã„ã¨"], ko: "ì„¤ëª…ì„ ë“£ê³  ë‚˜ì„œê°€ ì•„ë‹ˆë©´ (ã€œã¦ã‹ã‚‰ã§ãªã„ã¨)" },
            { lvl: 1, ja: ["å®¶æ—ã«", "å¯¾ã—ã¦", "å„ªã—ã", "ã—ãªã•ã„"], yomi: ["ã‹ããã«", "ãŸã„ã—ã¦", "ã‚„ã•ã—ã", "ã—ãªã•ã„"], ko: "ê°€ì¡±ì— ëŒ€í•´ì„œ ìƒëƒ¥í•˜ê²Œ ëŒ€í•˜ì„¸ìš” (ã€œã«å¯¾ã—ã¦)" },
            { lvl: 1, ja: ["è¡Œã", "ã¤ã„ã§ã«", "ãƒ‘ãƒ³ã‚’", "è²·ã£ã¦ãã¦"], yomi: ["ã„ã", "ã¤ã„ã§ã«", "ãƒ‘ãƒ³ã‚’", "ã‹ã£ã¦ãã¦"], ko: "ê°€ëŠ” ê¹€ì— ë¹µì„ ì‚¬ ì™€ (ã€œã¤ã„ã§ã«)" },
            { lvl: 1, ja: ["æ¼¢å­—ã¯", "æ›¸ã‘ã°", "æ›¸ãã»ã©", "è¦šãˆã‚‹"], yomi: ["ã‹ã‚“ã˜ã¯", "ã‹ã‘ã°", "ã‹ãã»ã©", "ãŠã¼ãˆã‚‹"], ko: "í•œìëŠ” ì“°ë©´ ì“¸ìˆ˜ë¡ ì™¸ì›Œì§„ë‹¤ (ã€œã°ã€œã»ã©)" },
            { lvl: 1, ja: ["ã“ã®", "éš›", "ã¯ã£ãã‚Š", "è¨€ã£ã¦ãŠã"], yomi: ["ã“ã®", "ã•ã„", "ã¯ã£ãã‚Š", "ã„ã£ã¦ãŠã"], ko: "ì´ì°¸ì— í™•ì‹¤íˆ ë§í•´ë‘”ë‹¤ (ã€œéš›)" },
            { lvl: 1, ja: ["å½¼ã¯", "ç—…æ°—", "æ°—å‘³", "ã§ã™"], yomi: ["ã‹ã‚Œã¯", "ã³ã‚‡ã†ã", "ãã¿", "ã§ã™"], ko: "ê·¸ëŠ” ì•„í”ˆ ê¸°ìƒ‰ì´ ìˆìŠµë‹ˆë‹¤ (ã€œæ°—å‘³)" },

            // [2ë‹¨ê³„] ì‘ìš© N2
            { lvl: 2, ja: ["å¿™ã—ã„", "ã‚ã‚Šã«", "çµ¦æ–™ãŒ", "å®‰ã„"], yomi: ["ã„ããŒã—ã„", "ã‚ã‚Šã«", "ãã‚…ã†ã‚Šã‚‡ã†ãŒ", "ã‚„ã™ã„"], ko: "ë°”ìœ ê²ƒì— ë¹„í•´ ê¸‰ì—¬ê°€ ì‹¸ë‹¤ (ã€œã‚ã‚Šã«)" },
            { lvl: 2, ja: ["å­ä¾›", "ã˜ã‚ƒ", "ã‚ã‚‹ã¾ã„", "ã—"], yomi: ["ã“ã©ã‚‚", "ã˜ã‚ƒ", "ã‚ã‚‹ã¾ã„", "ã—"], ko: "ì–´ë¦°ì• ë„ ì•„ë‹ˆê³  ë§ì´ì•¼ (ã€œã˜ã‚ƒã‚ã‚‹ã¾ã„ã—)" },
            { lvl: 2, ja: ["å¬‰ã—ã•ã®", "ã‚ã¾ã‚Š", "æ³£ã„ã¦", "ã—ã¾ã£ãŸ"], yomi: ["ã†ã‚Œã—ã•ã®", "ã‚ã¾ã‚Š", "ãªã„ã¦", "ã—ã¾ã£ãŸ"], ko: "ë„ˆë¬´ ê¸°ìœ ë‚˜ë¨¸ì§€ ìš¸ì–´ë²„ë ¸ë‹¤ (ã€œã‚ã¾ã‚Š)" },
            { lvl: 2, ja: ["å½¼ãŒ", "çŠ¯äºº", "ã§ã‚ã‚‹", "ã¯ãšãŒãªã„"], yomi: ["ã‹ã‚ŒãŒ", "ã¯ã‚“ã«ã‚“", "ã§ã‚ã‚‹", "ã¯ãšãŒãªã„"], ko: "ê·¸ê°€ ë²”ì¸ì¼ ë¦¬ê°€ ì—†ë‹¤ (ã€œã¯ãšãŒãªã„)" },
            { lvl: 2, ja: ["ä¸€åº¦", "è¨€ã£ãŸ", "ä»¥ä¸Š", "å®ˆã‚‹ã¹ãã "], yomi: ["ã„ã¡ã©", "ã„ã£ãŸ", "ã„ã˜ã‚‡ã†", "ã¾ã‚‚ã‚‹ã¹ãã "], ko: "í•œë²ˆ ë§í•œ ì´ìƒ ì§€ì¼œì•¼ í•œë‹¤ (ã€œä»¥ä¸Š)" },
            { lvl: 2, ja: ["è€ƒãˆ", "ã‚ˆã†ã¨", "ã—ãªã„", "ã®ã§ã™ã‹"], yomi: ["ã‹ã‚“ãŒãˆ", "ã‚ˆã†ã¨", "ã—ãªã„", "ã®ã§ã™ã‹"], ko: "ìƒê°í•˜ë ¤ê³  í•˜ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆê¹Œ? (ã€œã‚ˆã†ã¨ã™ã‚‹)" },
            { lvl: 2, ja: ["ä¼‘ã‚€", "ã“ã¨ãªã", "åƒã", "ç¶šã‘ãŸ"], yomi: ["ã‚„ã™ã‚€", "ã“ã¨ãªã", "ã¯ãŸã‚‰ã", "ã¤ã¥ã‘ãŸ"], ko: "ì‰¬ëŠ” ì¼ ì—†ì´ ê³„ì† ì¼í–ˆë‹¤ (ã€œã“ã¨ãªã)" },
            { lvl: 2, ja: ["ä¼šè­°ã¯", "ä»Šã‹ã‚‰", "å§‹ã¾ã‚‹", "ã¨ã“ã‚ã "], yomi: ["ã‹ã„ãã¯", "ã„ã¾ã‹ã‚‰", "ã¯ã˜ã¾ã‚‹", "ã¨ã“ã‚ã "], ko: "íšŒì˜ëŠ” ì§€ê¸ˆë¶€í„° ì‹œì‘í•˜ë ¤ëŠ” ì°¸ì´ë‹¤ (ã€œã¨ã“ã‚ã )" },
            { lvl: 2, ja: ["ã‚„ã‚‹", "ã—ã‹ãªã„", "ã¨", "æ€ã†"], yomi: ["ã‚„ã‚‹", "ã—ã‹ãªã„", "ã¨", "ãŠã‚‚ã†"], ko: "í•  ìˆ˜ë°–ì— ì—†ë‹¤ê³  ìƒê°í•œë‹¤ (ã€œã—ã‹ãªã„)" },
            { lvl: 2, ja: ["ãŸã¨ãˆ", "è¦ª", "ã§ã‚‚", "è¨±ã•ãªã„"], yomi: ["ãŸã¨ãˆ", "ãŠã‚„", "ã§ã‚‚", "ã‚†ã‚‹ã•ãªã„"], ko: "ì„¤ë ¹ ë¶€ëª¨ë¼ë„ ìš©ì„œí•˜ì§€ ì•ŠëŠ”ë‹¤ (ã€œãŸã¨ãˆã€œã¦ã‚‚)" },
            { lvl: 2, ja: ["çŸ¥ã‚‰ãªã„", "ãµã‚Šã‚’", "ã—ã¦", "ã„ã‚‹"], yomi: ["ã—ã‚‰ãªã„", "ãµã‚Šã‚’", "ã—ã¦", "ã„ã‚‹"], ko: "ëª¨ë¥´ëŠ” ì²™ì„ í•˜ê³  ìˆë‹¤ (ã€œãµã‚Šã‚’ã™ã‚‹)" },
            { lvl: 2, ja: ["æ™‚é–“ã•ãˆ", "ã‚ã‚Œã°", "ã§ãã‚‹", "ã®ã«"], yomi: ["ã˜ã‹ã‚“ã•ãˆ", "ã‚ã‚Œã°", "ã§ãã‚‹", "ã®ã«"], ko: "ì‹œê°„ë§Œ ìˆìœ¼ë©´ í•  ìˆ˜ ìˆëŠ”ë° (ã€œã•ãˆã€œã°)" },
            { lvl: 2, ja: ["é£Ÿã¹", "ã‹ã‘ã®", "ãƒ‘ãƒ³ãŒ", "ã‚ã‚‹"], yomi: ["ãŸã¹", "ã‹ã‘ã®", "ãƒ‘ãƒ³ãŒ", "ã‚ã‚‹"], ko: "ë¨¹ë‹¤ ë§Œ ë¹µì´ ìˆë‹¤ (ã€œã‹ã‘)" },
            { lvl: 2, ja: ["å±±é ‚ã«", "å‘ã‹ã£ã¦", "æ­©ã", "å‡ºã—ãŸ"], yomi: ["ã•ã‚“ã¡ã‚‡ã†ã«", "ã‚€ã‹ã£ã¦", "ã‚ã‚‹ã", "ã ã—ãŸ"], ko: "ì‚° ì •ìƒì„ í–¥í•´ ê±·ê¸° ì‹œì‘í–ˆë‹¤ (ã€œã«å‘ã‹ã£ã¦)" },

            // [3ë‹¨ê³„] ì‹¤ì „ N2
            { lvl: 3, ja: ["æã‚Œ", "å…¥ã‚Šã¾ã™ãŒ", "ãŠåå‰ã‚’", "ä¼ºãˆã¾ã™ã‹"], yomi: ["ãŠãã‚Œ", "ã„ã‚Šã¾ã™ãŒ", "ãŠãªã¾ãˆã‚’", "ã†ã‹ãŒãˆã¾ã™ã‹"], ko: "ì†¡êµ¬í•©ë‹ˆë‹¤ë§Œ ì„±í•¨ì„ ì—¬ì­¤ë´ë„ ë ê¹Œìš”? (ê²½ì–´)" },
            { lvl: 3, ja: ["ã‚ã®", "åº—ã¯", "å®‰ãã¦", "ãŠã„ã—ã„"], yomi: ["ã‚ã®", "ã¿ã›ã¯", "ã‚„ã™ãã¦", "ãŠã„ã—ã„"], ko: "ì € ê°€ê²ŒëŠ” ì‹¸ê³  ë§›ìˆë‹¤ (ë‹¨ìˆœí•˜ì§€ë§Œ ê¸´ ìˆ˜ì‹)" },
            { lvl: 3, ja: ["å„ªå‹", "ã—ãŸ", "ãªã‚“ã¦", "ä¿¡ã˜ã‚‰ã‚Œãªã„"], yomi: ["ã‚†ã†ã—ã‚‡ã†", "ã—ãŸ", "ãªã‚“ã¦", "ã—ã‚“ã˜ã‚‰ã‚Œãªã„"], ko: "ìš°ìŠ¹í–ˆë‹¤ë‹ˆ ë¯¿ì„ ìˆ˜ ì—†ë‹¤ (ã€œãªã‚“ã¦)" },
            { lvl: 3, ja: ["ä¼šã£ã¦", "ã¿ã¦", "åˆã‚ã¦", "ã‚ã‹ã£ãŸ"], yomi: ["ã‚ã£ã¦", "ã¿ã¦", "ã¯ã˜ã‚ã¦", "ã‚ã‹ã£ãŸ"], ko: "ë§Œë‚˜ë³´ê³ ì„œì•¼ ë¹„ë¡œì†Œ ì•Œì•˜ë‹¤ (ã€œã¦ã¯ã˜ã‚ã¦)" },
            { lvl: 3, ja: ["æ–°è»Š", "ã©ã“ã‚ã‹", "è‡ªè»¢è»Šã‚‚", "ãªã„"], yomi: ["ã—ã‚“ã—ã‚ƒ", "ã©ã“ã‚ã‹", "ã˜ã¦ã‚“ã—ã‚ƒã‚‚", "ãªã„"], ko: "ìƒˆ ì°¨ëŠ”ì»¤ë…• ìì „ê±°ë„ ì—†ë‹¤ (ã€œã©ã“ã‚ã‹)" },
            { lvl: 3, ja: ["èª¿ã¹ãŸ", "ä¸Šã§", "é€£çµ¡", "ã—ã¾ã™"], yomi: ["ã—ã‚‰ã¹ãŸ", "ã†ãˆã§", "ã‚Œã‚“ã‚‰ã", "ã—ã¾ã™"], ko: "ì¡°ì‚¬í•œ ë’¤ì— ì—°ë½í•˜ê² ìŠµë‹ˆë‹¤ (ã€œãŸä¸Šã§)" },
            { lvl: 3, ja: ["å¸°ã‚ã†ã¨", "ã—ãŸ", "ã¨ã“ã‚ã«", "é›»è©±ãŒæ¥ãŸ"], yomi: ["ã‹ãˆã‚ã†ã¨", "ã—ãŸ", "ã¨ã“ã‚ã«", "ã§ã‚“ã‚ãŒããŸ"], ko: "ëŒì•„ê°€ë ¤ê³  í–ˆë˜ ì°¸ì— ì „í™”ê°€ ì™”ë‹¤ (ã€œã¨ã—ãŸã¨ã“ã‚ã«)" },
            { lvl: 3, ja: ["è¡Œã‘ã‚‹", "ã‚‚ã®ãªã‚‰", "è¡ŒããŸã„", "ã§ã™ã­"], yomi: ["ã„ã‘ã‚‹", "ã‚‚ã®ãªã‚‰", "ã„ããŸã„", "ã§ã™ã­"], ko: "ê°ˆ ìˆ˜ë§Œ ìˆë‹¤ë©´ ê°€ê³  ì‹¶ë„¤ìš” (ã€œã‚‚ã®ãªã‚‰)" },
            { lvl: 3, ja: ["è²·ã‚", "ã•ã‚Œã‚‹", "ã¨ã“ã‚", "ã ã£ãŸ"], yomi: ["ã‹ã‚", "ã•ã‚Œã‚‹", "ã¨ã“ã‚", "ã ã£ãŸ"], ko: "ê°•ë§¤ë‹¹í• (ì‚¬ê²Œ ë ) ë»”í–ˆë‹¤ (ì‚¬ì—­ìˆ˜ë™ + ã¨ã“ã‚ã ã£ãŸ)" },
            { lvl: 3, ja: ["å½¼ã«", "ä»»ã›ã‚Œã°", "å®‰å¿ƒ", "ã "], yomi: ["ã‹ã‚Œã«", "ã¾ã‹ã›ã‚Œã°", "ã‚ã‚“ã—ã‚“", "ã "], ko: "ê·¸ì—ê²Œ ë§¡ê¸°ë©´ ì•ˆì‹¬ì´ë‹¤" },
            { lvl: 3, ja: ["å…ˆç”Ÿã®", "ãŠã‹ã’ã§", "åˆæ ¼", "ã§ãã¾ã—ãŸ"], yomi: ["ã›ã‚“ã›ã„ã®", "ãŠã‹ã’ã§", "ã”ã†ã‹ã", "ã§ãã¾ã—ãŸ"], ko: "ì„ ìƒë‹˜ ë•ë¶„ì— í•©ê²©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤" },
            { lvl: 3, ja: ["èª°ã«", "èã„ã¦ã‚‚", "åˆ†ã‹ã‚‰", "ãªã„"], yomi: ["ã ã‚Œã«", "ãã„ã¦ã‚‚", "ã‚ã‹ã‚‰", "ãªã„"], ko: "ëˆ„êµ¬ì—ê²Œ ë¬¼ì–´ë„ ì•Œ ìˆ˜ ì—†ë‹¤" }
        ];

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
        let gameData = [];
        let currentIndex = 0;
        let currentScore = 0;
        let maxPossibleScore = 0;
        let combo = 0;
        let currentStage = 1;
        let questionStartTime = 0;
        let timerInterval = null;
        let isMistaken = false;
        let step = 0;
        let currentOptions = []; 
        let isTimerRunning = false;

        // --- ì´ˆê¸°í™” ---
        function setStage(lvl) {
            currentStage = lvl;
            document.querySelectorAll('.tab-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx + 1 === lvl);
            });
            initGame();
        }

        function initGame() {
            // [ë²„ê·¸ ìˆ˜ì •] ê²Œì„íŒ(HTML)ì´ ì‚¬ë¼ì¡Œì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°•ì œë¡œ ë³µêµ¬í•©ë‹ˆë‹¤!
            const gameBody = document.querySelector('.game-body');
            gameBody.innerHTML = `
                <div class="progress-bar-container"><div class="progress-fill" id="progress-bar"></div></div>
                <div class="answer-zone" id="answer-zone"></div>
                <div class="message-zone" id="message-box"><span>ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!</span></div>
                <div class="options-zone" id="options-zone"></div>
                <div class="controls-zone">
                    <button class="action-btn btn-audio" id="btn-audio" onclick="playTTS()">ğŸ”Š ë¬¸ì¥ ë“£ê¸°</button>
                    <button class="action-btn btn-next" id="btn-next" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¡</button>
                </div>
            `;

            const filtered = rawData.filter(d => d.lvl === currentStage);
            gameData = [...filtered].sort(() => 0.5 - Math.random()).slice(0, 10);
            
            currentIndex = 0;
            currentScore = 0;
            combo = 0;
            maxPossibleScore = 425; 

            document.getElementById('current-score').textContent = "0";
            document.getElementById('max-score').textContent = maxPossibleScore;
            document.getElementById('yomi-toggle').checked = false; 
            
            loadQuestion();
        }

        function loadQuestion() {
            step = 0;
            isMistaken = false;
            isTimerRunning = false; 
            stopTimer();
            document.querySelector('.timer-display').textContent = "0.00";
            document.getElementById('q-current').textContent = currentIndex + 1; 
            
            document.getElementById('answer-zone').innerHTML = '';
            document.getElementById('answer-zone').classList.remove('shake');
            
            document.getElementById('options-zone').style.display = 'flex';
            document.getElementById('options-zone').innerHTML = '';
            
            document.getElementById('btn-next').style.display = 'none';
            document.getElementById('btn-audio').style.display = 'none';
            
            const pct = ((currentIndex) / 10) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;

            if (currentIndex >= 10) {
                endGame();
                return;
            }

            const curQ = gameData[currentIndex];
            
            document.getElementById('message-box').innerHTML = `
                <div style="font-size:1.4rem; color:#555; margin-bottom:5px;">ë‹¤ìŒ ë¬¸ì¥ì„ ë§Œë“œì„¸ìš”:</div>
                <div class="hint-text">
                    ${curQ.ko}
                </div>
            `;
            
            const ansZone = document.getElementById('answer-zone');
            curQ.ja.forEach((_, i) => {
                let s = document.createElement('div');
                s.className = 'slot';
                s.id = `slot-${i}`;
                ansZone.appendChild(s);
            });

            currentOptions = curQ.ja.map((txt, idx) => ({ 
                text: txt, 
                yomi: curQ.yomi[idx], 
                id: idx 
            })).sort(() => 0.5 - Math.random());
            
            renderOptions(true); 

            if (currentIndex > 0) {
                startTimer();
            }
        }

        function getWordHTML(text, yomi) {
            const isYomi = document.getElementById('yomi-toggle').checked;
            if (isYomi) {
                return `<div class="ruby-box"><span class="ruby-yomi">${yomi}</span><span class="ruby-text">${text}</span></div>`;
            } else {
                return `<span class="ruby-text">${text}</span>`;
            }
        }

        function toggleYomigana() {
            renderOptions(false);
            const curQ = gameData[currentIndex];
            for(let i=0; i<step; i++) {
                const slot = document.getElementById(`slot-${i}`);
                slot.innerHTML = getWordHTML(curQ.ja[i], curQ.yomi[i]);
            }
        }

        function renderOptions(isReset = false) {
            const optZone = document.getElementById('options-zone');
            
            const hiddenStatus = [];
            if (!isReset) {
                document.querySelectorAll('.word-btn').forEach(btn => {
                    hiddenStatus.push(btn.classList.contains('hidden'));
                });
            }

            optZone.innerHTML = '';
            currentOptions.forEach((opt, idx) => {
                let btn = document.createElement('div');
                btn.className = 'word-btn';
                btn.innerHTML = getWordHTML(opt.text, opt.yomi);
                
                if(!isReset && hiddenStatus.length > 0 && hiddenStatus[idx]) {
                    btn.classList.add('hidden');
                }

                btn.onclick = () => handleInput(btn, opt, idx);
                optZone.appendChild(btn);
            });
        }

        function startTimer() {
            if(isTimerRunning) return; 
            
            isTimerRunning = true;
            questionStartTime = Date.now();
            const display = document.querySelector('.timer-display');
            
            timerInterval = setInterval(() => {
                const now = Date.now();
                const diff = (now - questionStartTime) / 1000;
                display.textContent = diff.toFixed(2);
            }, 30);
        }

        function stopTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
        }

        function handleInput(btn, optObj, btnIdx) {
            if(document.getElementById('btn-next').style.display === 'flex') return;

            if (!isTimerRunning && currentIndex === 0) {
                startTimer();
            }

            if (optObj.id === step) {
                const curQ = gameData[currentIndex];
                
                const slot = document.getElementById(`slot-${step}`);
                slot.innerHTML = getWordHTML(curQ.ja[step], curQ.yomi[step]);
                slot.classList.add('filled');
                
                btn.classList.add('hidden');
                step++;

                if (step === 4) {
                    stopTimer();
                    calcScore();
                    showSuccessUI();
                }
            } else {
                handleMistake();
            }
        }

        function handleMistake() {
            const curQ = gameData[currentIndex];
            const ansZone = document.getElementById('answer-zone');
            ansZone.classList.remove('shake');
            void ansZone.offsetWidth;
            ansZone.classList.add('shake');

            step = 0;
            document.querySelectorAll('.slot').forEach(s => {
                s.innerHTML = '';
                s.classList.remove('filled');
            });
            
            renderOptions(true); 

            isMistaken = true;
            combo = 0;

            const msgBox = document.getElementById('message-box');
            msgBox.innerHTML = `
                <span style="color:#ef4444; font-size:2.0rem; font-weight:800;">âš ï¸ í‹€ë ¸ìŠµë‹ˆë‹¤! (ë‹¤ì‹œ!)</span>
                <div class="hint-text" style="font-size:1.6rem;">
                    ${curQ.ko}
                </div>
            `;
        }

        // [í•µì‹¬] ì ìˆ˜ ê³„ì‚° ë° íŒì—… í‘œì‹œ
        function calcScore() {
            const timeSpent = (Date.now() - questionStartTime) / 1000;
            let points = 0;
            let label = "";
            let color = "#10b981"; // ê¸°ë³¸ ì´ˆë¡
            let size = "3rem";

            if (isMistaken) {
                points = 10;
                label = "+10";
                color = "#555";
            } else {
                let base = 10;
                let timeBonus = 0;
                if (timeSpent <= 5.0) timeBonus = 10;
                else if (timeSpent <= 12.0) timeBonus = 5;
                
                let comboBonus = combo * 5;
                points = base + timeBonus + comboBonus;
                combo++;

                // ë¼ë²¨ ìƒì„±
                label = `+${points}`;
                if(combo > 1) {
                    label += `<div style="font-size:1.5rem; margin-top:5px;">${combo} Combo!ğŸ”¥</div>`;
                    color = "#f59e0b"; // ì½¤ë³´ ì‹œ ê³¨ë“œ
                    size = "4rem";
                } else if (timeBonus === 10) {
                     label += `<div style="font-size:1.2rem; margin-top:5px;">Perfect!âš¡</div>`;
                     color = "#ef4444"; // ìŠ¤í”¼ë“œ ë³´ë„ˆìŠ¤ ë ˆë“œ
                }
            }

            currentScore += points;
            document.getElementById('current-score').textContent = currentScore;
            
            // íŒì—… ë„ìš°ê¸°
            showScorePopup(label, color, size);
        }

        // íŒì—… ìƒì„± í•¨ìˆ˜
        function showScorePopup(text, color, fontSize) {
            const body = document.getElementById('game-body');
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.innerHTML = text;
            popup.style.color = color;
            popup.style.fontSize = fontSize;
            popup.style.textShadow = `2px 2px 0px white, 0 0 10px ${color}`;
            
            body.appendChild(popup);
            
            // ì• ë‹ˆë©”ì´ì…˜ í›„ ì‚­ì œ
            setTimeout(() => {
                popup.remove();
            }, 1200);
        }

        function showSuccessUI() {
            const curQ = gameData[currentIndex];
            const msgBox = document.getElementById('message-box');

            document.getElementById('options-zone').style.display = 'none';
            
            const fullSentence = curQ.ja.map((txt, i) => 
                `<div class="ruby-box" style="margin:0 4px;">
                    <span class="ruby-yomi" style="font-size:1.3rem;">${curQ.yomi[i]}</span>
                    <span class="ruby-text" style="font-size:2.5rem;">${txt}</span>
                </div>`
            ).join('');

            let comboMsg = combo > 1 ? ` <span style="color:#f59e0b; font-size:1.6rem;">(${combo} Combo!)</span>` : "";
            
            msgBox.innerHTML = `
                <span style="color:#10b981; font-size:2.2rem; margin-bottom:10px; font-weight:900;">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</span>
                <div style="display:flex; flex-wrap:wrap; justify-content:center;">${fullSentence}</div>
                <div class="hint-text" style="color:#333; background:#f0fdf4; margin-top:10px; font-size:1.8rem;">${curQ.ko}</div>
            `;

            document.getElementById('btn-next').style.display = 'flex';
            document.getElementById('btn-audio').style.display = 'flex';
        }

        function playTTS() {
            const curQ = gameData[currentIndex];
            const fullJa = curQ.ja.join('');
            
            if ('speechSynthesis' in window) {
                const utter = new SpeechSynthesisUtterance(fullJa);
                utter.lang = 'ja-JP';
                utter.rate = 0.9;
                window.speechSynthesis.speak(utter);
            } else {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
        }

        function nextQuestion() {
            currentIndex++;
            loadQuestion();
        }

        function endGame() {
            const wrapper = document.querySelector('.game-body');
            let color = currentScore >= (maxPossibleScore * 0.8) ? '#10b981' : '#ef4444';
            
            wrapper.innerHTML = `
                <h2 style="font-size:3.5rem; color:${color}; margin-bottom:10px;">Game Clear!</h2>
                <p style="font-size:2rem; margin-bottom:20px;">
                    ìµœì¢… ì ìˆ˜: <strong style="font-size:4rem; color:${color};">${currentScore}</strong> / ${maxPossibleScore}
                </p>
                <p style="color:#555; font-size:1.5rem;">ë‹¨ê³„ë³„ë¡œ ê³„ì† ë„ì „í•´ì„œ ë§Œì ì„ ë…¸ë ¤ë³´ì„¸ìš”!</p>
                <button class="action-btn btn-next" style="display:inline-flex; margin-top:30px; font-size:1.6rem;" onclick="initGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            `;
        }

        window.onload = () => setStage(1);
    </script>
</body>
</html>
