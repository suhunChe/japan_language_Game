<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N3 ë‹¨ì–´ í€´ì¦ˆ 3 (í•œì ì½ê¸°)</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4c1d95; /* N3 3íƒ„ ë‹¤í¬ ë°”ì´ì˜¬ë › í…Œë§ˆ */
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #7c3aed; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #f5f3ff; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* N3 3íƒ„ ì „ìš© ìŠ¤íƒ€ì¼ (Unique ID: jp-n3-3) */
        #jp-n3-3-wrapper {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #f5f3ff; /* ì•„ì£¼ ì—°í•œ ë°”ì´ì˜¬ë › ë°°ê²½ */
            color: #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center; /* ì˜¤íƒ€ ìˆ˜ì •ë¨ */
            padding: 10px; border-radius: 10px; margin: 0 auto 30px auto; position: relative; /* ì¤‘ì•™ ì •ë ¬ìš© margin ì¶”ê°€ */
            --max-width: 650px;
            --primary-color: #7c3aed; /* ë°”ì´ì˜¬ë › 600 */
            --dark-color: #4c1d95;
            --accent-color: #f59e0b; /* ì•°ë²„ í¬ì¸íŠ¸ */
            
            /* [ë³´í†µ] ì‚¬ì´ì¦ˆ */
            --q-size: 50px; --ex-size: 18px; --opt-size: 18px; --ruby-size: 16px; --card-pad: 25px; --btn-pad: 14px;
        }

        #jp-n3-3-wrapper.size-small { --q-size: 30px; --ex-size: 14px; --opt-size: 14px; --ruby-size: 12px; --card-pad: 15px; --btn-pad: 10px; }
        #jp-n3-3-wrapper.size-large { --q-size: 70px; --ex-size: 24px; --opt-size: 24px; --ruby-size: 20px; --card-pad: 32px; --btn-pad: 18px; }

        #jp-n3-3-wrapper .quiz-container {
            background-color: #ffffff; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.2); text-align: center;
            width: 100%; max-width: var(--max-width); position: relative; border: 2px solid var(--primary-color);
            box-sizing: border-box;
        }

        .control-panel { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; background: #ede9fe; padding: 8px 12px; border-radius: 10px; }
        .set-group { display: flex; flex-wrap: wrap; gap: 4px; }
        .set-btn { background: #fff; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .set-btn.active { background: var(--primary-color); color: white; }
        .set-btn-all { border-color: var(--accent-color); color: #d97706; }
        .set-btn-all.active { background: var(--accent-color); color: white; }
        .size-group { display: flex; gap: 2px; }
        .size-btn { background: #e5e7eb; border: none; padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .size-btn.active { background: #4c1d95; color: white; }

        .status-bar { display: flex; justify-content: space-between; align-items: center; background: #4c1d95; color: white; padding: 8px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; font-weight: bold; }
        .status-item { display: flex; align-items: center; gap: 5px; }
        .timer-icon { color: var(--accent-color); }
        .score-box { color: #a78bfa; }

        .question-card { padding: var(--card-pad); margin-bottom: 15px; border-bottom: 1px dashed #c4b5fd; }
        .word-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        /* í•œì í€´ì¦ˆì´ë¯€ë¡œ ê¸°ë³¸ ë£¨ë¹„ëŠ” ìˆ¨ê¸°ê±°ë‚˜ ë¬¸ì œì—ë§Œ ì§‘ì¤‘ */
        .kanji-text { font-size: var(--q-size); font-weight: bold; color: var(--dark-color); line-height: 1.2; font-family: "MS Mincho", serif; }
        
        .audio-btn { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn:hover { background: #e5e7eb; }

        .example-box { background: #f8fafc; padding: 15px; border-radius: 8px; font-size: var(--ex-size); color: #475569; line-height: 1.6; text-align: left; border: 1px solid #e2e8f0; }
        .highlight { color: #d97706; font-weight: bold; background: #fef3c7; padding: 0 4px; border-radius: 4px; }
        .hint-box { display: none; margin-top: 10px; font-size: calc(var(--ex-size) - 2px); color: #7c3aed; font-weight: bold; animation: fadeIn 0.3s; border-top: 1px solid #e2e8f0; padding-top: 8px; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn { background-color: #f8fafc; border: 1px solid #e2e8f0; color: #334155; padding: var(--btn-pad); font-size: var(--opt-size); border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.1s; }
        .opt-btn:hover { background-color: #ede9fe; border-color: var(--primary-color); }
        .opt-btn.correct { background-color: #7c3aed !important; color: white !important; border-color: #7c3aed; }
        .opt-btn.wrong { background-color: #ef4444 !important; color: white !important; border-color: #ef4444; opacity: 0.6; }
        .opt-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .next-btn { display: none; width: 100%; margin-top: 20px; padding: 15px; background-color: var(--primary-color); color: white; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; animation: fadeIn 0.3s; }
        .next-btn:hover { background-color: #6d28d9; }

        #resultScreen_n3_3 { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.99); border-radius: 15px; flex-direction: column; align-items: center; justify-content: center; z-index: 50; padding: 20px; box-sizing: border-box; }
        .review-list { width: 100%; max-height: 200px; overflow-y: auto; background: #f1f5f9; border-radius: 8px; padding: 10px; margin: 15px 0; text-align: left; }
        .review-item { border-bottom: 1px solid #e2e8f0; padding: 8px 0; font-size: 14px; }
        .review-item:last-child { border-bottom: none; }
        .review-word { font-weight: bold; color: var(--dark-color); font-size: 16px;}
        .review-mean { color: #475569; }

        .disabled-area { pointer-events: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body style="background-color: #f5f3ff; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="jp-n3-3-wrapper">
        <div class="quiz-container">
            <div class="control-panel">
                <div class="set-group">
                    <button class="set-btn active" onclick="JpN3_3.changeSet(0)">Set 1</button>
                    <button class="set-btn" onclick="JpN3_3.changeSet(1)">Set 2</button>
                    <button class="set-btn" onclick="JpN3_3.changeSet(2)">Set 3</button>
                    <button class="set-btn" onclick="JpN3_3.changeSet(3)">Set 4</button>
                    <button class="set-btn" onclick="JpN3_3.changeSet(4)">Set 5</button>
                    <button class="set-btn set-btn-all" onclick="JpN3_3.changeSet('all')">ALL</button>
                </div>
                <div class="size-group">
                    <button class="size-btn" onclick="JpN3_3.setSize('small')">ì‘ê²Œ</button>
                    <button class="size-btn active" onclick="JpN3_3.setSize('medium')" id="btnSizeM">ë³´í†µ</button>
                    <button class="size-btn" onclick="JpN3_3.setSize('large')">í¬ê²Œ</button>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-item"><span>ğŸ“</span><span id="qCount_n3_3">1 / 20</span></div>
                <div class="status-item"><span class="timer-icon">â±ï¸</span><span id="timerDisplay_n3_3">0s</span></div>
                <div class="status-item score-box"><span>ğŸ†</span><span id="liveScore_n3_3">0</span></div>
            </div>

            <div class="question-card">
                <div class="word-row">
                    <div class="kanji-text" id="qWord_n3_3">æ¼¢å­—</div>
                    <button class="audio-btn" onclick="JpN3_3.speak()" title="ë“£ê¸°">ğŸ”Š</button>
                </div>
                <div class="example-box">
                    <span id="qExample_n3_3">...</span>
                    <div class="hint-box" id="qHint_n3_3">...</div>
                </div>
            </div>

            <div class="options-grid" id="qOptions_n3_3"></div>

            <button id="btnNext_n3_3" class="next-btn" onclick="JpN3_3.nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â–¶</button>

            <div id="resultScreen_n3_3">
                <h2 style="color:#4c1d95; margin:0 0 10px 0;">ê²°ê³¼ ë¦¬í¬íŠ¸</h2>
                <div style="font-size:36px; font-weight:bold; color:#7c3aed; margin-bottom:5px;"><span id="finalScore_n3_3">0</span>ì </div>
                <div style="font-size:14px; color:#64748b; margin-bottom:15px;">(ì´ì  <span id="maxScore_n3_3">0</span>ì  ì¤‘)</div>
                <div id="wrongListHeader_n3_3" style="width:100%; text-align:left; font-size:14px; font-weight:bold; color:#333; margin-bottom:5px;">âŒ í‹€ë¦° ë‹¨ì–´ (ì½ê¸° ì£¼ì˜)</div>
                <div class="review-list" id="wrongList_n3_3"></div>
                <button class="next-btn" style="display:block; width:auto; padding:10px 30px;" onclick="JpN3_3.initGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
    (function() {
        // N3 3íƒ„ ë°ì´í„°: í•œì -> ìš”ë¯¸ê°€ë‚˜(m) (100ì„ )
        // q: í•œì, m: ìš”ë¯¸ê°€ë‚˜(ì •ë‹µ), tr: ëœ»(íŒíŠ¸)
        const dataPool = [
            // Set 1: ì¥ìŒ/ë‹¨ìŒ/ì´‰ìŒ ì£¼ì˜ (Long Vowels & Pauses)
            {q:"ç©ºæ¸¯", m:"ãã†ã“ã†", tr:"ê³µí•­", ex:"<span class='highlight'>ç©ºæ¸¯</span>ã¸è¡Œãã€‚", set:1},
            {q:"å¤«å©¦", m:"ãµã†ãµ", tr:"ë¶€ë¶€", ex:"ä»²ã®è‰¯ã„<span class='highlight'>å¤«å©¦</span>ã€‚", set:1},
            {q:"ç‰›ä¹³", m:"ãã‚…ã†ã«ã‚…ã†", tr:"ìš°ìœ ", ex:"<span class='highlight'>ç‰›ä¹³</span>ã‚’é£²ã‚€ã€‚", set:1},
            {q:"åŠ´åƒ", m:"ã‚ã†ã©ã†", tr:"ë…¸ë™", ex:"<span class='highlight'>åŠ´åƒ</span>æ™‚é–“ãŒé•·ã„ã€‚", set:1},
            {q:"é“è·¯", m:"ã©ã†ã‚", tr:"ë„ë¡œ", ex:"åºƒã„<span class='highlight'>é“è·¯</span>ã€‚", set:1},
            {q:"æ³•å¾‹", m:"ã»ã†ã‚Šã¤", tr:"ë²•ë¥ ", ex:"<span class='highlight'>æ³•å¾‹</span>ã‚’å®ˆã‚‹ã€‚", set:1},
            {q:"æ–¹æ³•", m:"ã»ã†ã»ã†", tr:"ë°©ë²•", ex:"è‰¯ã„<span class='highlight'>æ–¹æ³•</span>ã‚’æ¢ã™ã€‚", set:1},
            {q:"æ§˜å­", m:"ã‚ˆã†ã™", tr:"ëª¨ìŠµ/ìƒíƒœ", ex:"å½¼å¥³ã®<span class='highlight'>æ§˜å­</span>ãŒãŠã‹ã—ã„ã€‚", set:1},
            {q:"èª¿å­", m:"ã¡ã‚‡ã†ã—", tr:"ìƒíƒœ/ì»¨ë””ì…˜", ex:"ä½“ã®<span class='highlight'>èª¿å­</span>ãŒã„ã„ã€‚", set:1},
            {q:"çµæ§‹", m:"ã‘ã£ã“ã†", tr:"í›Œë¥­í•¨/ê½¤", ex:"ãã‚Œã¯<span class='highlight'>çµæ§‹</span>ãªè©±ã ã€‚", set:1},
            {q:"çµå±€", m:"ã‘ã£ãã‚‡ã", tr:"ê²°êµ­", ex:"<span class='highlight'>çµå±€</span>ã€è¡Œã‹ãªã‹ã£ãŸã€‚", set:1},
            {q:"ç™ºè¡¨", m:"ã¯ã£ã´ã‚‡ã†", tr:"ë°œí‘œ", ex:"çµæœã‚’<span class='highlight'>ç™ºè¡¨</span>ã™ã‚‹ã€‚", set:1},
            {q:"å‡ºç™º", m:"ã—ã‚…ã£ã±ã¤", tr:"ì¶œë°œ", ex:"ã¾ã‚‚ãªã<span class='highlight'>å‡ºç™º</span>ã™ã‚‹ã€‚", set:1},
            {q:"å¤±æ•—", m:"ã—ã£ã±ã„", tr:"ì‹¤íŒ¨", ex:"å®Ÿé¨“ã«<span class='highlight'>å¤±æ•—</span>ã—ãŸã€‚", set:1},
            {q:"çµ¶å¯¾", m:"ãœã£ãŸã„", tr:"ì ˆëŒ€", ex:"<span class='highlight'>çµ¶å¯¾</span>ã«è¨±ã•ãªã„ã€‚", set:1},
            {q:"å®Ÿéš›", m:"ã˜ã£ã•ã„", tr:"ì‹¤ì œ", ex:"<span class='highlight'>å®Ÿéš›</span>ã«è¦‹ã¦ã¿ã‚‹ã€‚", set:1},
            {q:"é›‘èªŒ", m:"ã–ã£ã—", tr:"ì¡ì§€", ex:"<span class='highlight'>é›‘èªŒ</span>ã‚’èª­ã‚€ã€‚", set:1},
            {q:"åˆ‡ç¬¦", m:"ãã£ã·", tr:"í‘œ (í‹°ì¼“)", ex:"é›»è»Šã®<span class='highlight'>åˆ‡ç¬¦</span>ã‚’è²·ã†ã€‚", set:1},
            {q:"çŸ³é¹¸", m:"ã›ã£ã‘ã‚“", tr:"ë¹„ëˆ„", ex:"<span class='highlight'>çŸ³é¹¸</span>ã§æ‰‹ã‚’æ´—ã†ã€‚", set:1},
            {q:"ä¸€ç¬", m:"ã„ã£ã—ã‚…ã‚“", tr:"ì¼ìˆœê°„", ex:"<span class='highlight'>ä¸€ç¬</span>ã®å‡ºæ¥äº‹ã€‚", set:1},

            // Set 2: íƒìŒ/ë°˜íƒìŒ ì£¼ì˜ (Voiced Sounds)
            {q:"æ‰‹è¢‹", m:"ã¦ã¶ãã‚", tr:"ì¥ê°‘", ex:"<span class='highlight'>æ‰‹è¢‹</span>ã‚’ã™ã‚‹ã€‚", set:2},
            {q:"è¿‘æ‰€", m:"ãã‚“ã˜ã‚‡", tr:"ê·¼ì²˜/ì´ì›ƒ", ex:"<span class='highlight'>è¿‘æ‰€</span>ã®äººã€‚", set:2},
            {q:"å¤§å·¥", m:"ã ã„ã", tr:"ëª©ìˆ˜", ex:"å½¼ã¯<span class='highlight'>å¤§å·¥</span>ã ã€‚", set:2},
            {q:"é€€å±ˆ", m:"ãŸã„ãã¤", tr:"ì§€ë£¨í•¨/ì‹¬ì‹¬í•¨", ex:"<span class='highlight'>é€€å±ˆ</span>ãªæ˜ ç”»ã€‚", set:2},
            {q:"æ³¥æ£’", m:"ã©ã‚ã¼ã†", tr:"ë„ë‘‘", ex:"<span class='highlight'>æ³¥æ£’</span>ã«å…¥ã‚‰ã‚ŒãŸã€‚", set:2},
            {q:"é‰›ç­†", m:"ãˆã‚“ã´ã¤", tr:"ì—°í•„", ex:"<span class='highlight'>é‰›ç­†</span>ã§æ›¸ãã€‚", set:2},
            {q:"æ•£æ­©", m:"ã•ã‚“ã½", tr:"ì‚°ì±…", ex:"å…¬åœ’ã‚’<span class='highlight'>æ•£æ­©</span>ã™ã‚‹ã€‚", set:2},
            {q:"ä¹¾æ¯", m:"ã‹ã‚“ã±ã„", tr:"ê±´ë°°", ex:"ã¿ã‚“ãªã§<span class='highlight'>ä¹¾æ¯</span>ã™ã‚‹ã€‚", set:2},
            {q:"å¿ƒé…", m:"ã—ã‚“ã±ã„", tr:"ê±±ì •", ex:"è¦ªã«<span class='highlight'>å¿ƒé…</span>ã‚’ã‹ã‘ã‚‹ã€‚", set:2},
            {q:"å°»å°¾", m:"ã—ã£ã½", tr:"ê¼¬ë¦¬", ex:"çŠ¬ãŒ<span class='highlight'>å°»å°¾</span>ã‚’æŒ¯ã‚‹ã€‚", set:2},
            {q:"é‰„ç ²", m:"ã¦ã£ã½ã†", tr:"ì´", ex:"<span class='highlight'>é‰„ç ²</span>ã‚’æ’ƒã¤ã€‚", set:2},
            {q:"åå¿œ", m:"ã¯ã‚“ã®ã†", tr:"ë°˜ì‘", ex:"è–¬ã®<span class='highlight'>åå¿œ</span>ãŒå‡ºã‚‹ã€‚", set:2},
            {q:"åˆ¤æ–­", m:"ã¯ã‚“ã ã‚“", tr:"íŒë‹¨", ex:"è‡ªåˆ†ã§<span class='highlight'>åˆ¤æ–­</span>ã™ã‚‹ã€‚", set:2},
            {q:"æ„Ÿå‹•", m:"ã‹ã‚“ã©ã†", tr:"ê°ë™", ex:"æ˜ ç”»ã‚’è¦‹ã¦<span class='highlight'>æ„Ÿå‹•</span>ã—ãŸã€‚", set:2},
            {q:"æ¨ªæ–­", m:"ãŠã†ã ã‚“", tr:"íš¡ë‹¨", ex:"ã‚¢ãƒ¡ãƒªã‚«ã‚’<span class='highlight'>æ¨ªæ–­</span>ã™ã‚‹ã€‚", set:2},
            {q:"ç¾åœ¨", m:"ã’ã‚“ã–ã„", tr:"í˜„ì¬", ex:"<span class='highlight'>ç¾åœ¨</span>ã®æ™‚åˆ»ã€‚", set:2},
            {q:"é™åº¦", m:"ã’ã‚“ã©", tr:"í•œë„", ex:"æˆ‘æ…¢ã®<span class='highlight'>é™åº¦</span>ã‚’è¶…ãˆã‚‹ã€‚", set:2},
            {q:"ç¾è±¡", m:"ã’ã‚“ã—ã‚‡ã†", tr:"í˜„ìƒ", ex:"ä¸æ€è­°ãª<span class='highlight'>ç¾è±¡</span>ã€‚", set:2},
            {q:"è¨€èª", m:"ã’ã‚“ã”", tr:"ì–¸ì–´", ex:"å…±é€šã®<span class='highlight'>è¨€èª</span>ã€‚", set:2},
            {q:"åŸæ–™", m:"ã’ã‚“ã‚Šã‚‡ã†", tr:"ì›ë£Œ", ex:"ãƒ“ãƒ¼ãƒ«ã®<span class='highlight'>åŸæ–™</span>ã¯éº¦ã ã€‚", set:2},

            // Set 3: í›ˆë… (Kunyomi Verbs & Nouns)
            {q:"æ‰¿ã‚‹", m:"ã†ã‘ãŸã¾ã‚ã‚‹", tr:"ë°›ë“¤ë‹¤/ë“£ë‹¤ (ê²¸ì–‘)", ex:"ã”äºˆç´„ã‚’<span class='highlight'>æ‰¿ã‚Š</span>ã¾ã—ãŸã€‚", set:3},
            {q:"è€•ã™", m:"ãŸãŒã‚„ã™", tr:"(ë°­ì„) ê°ˆë‹¤", ex:"ç•‘ã‚’<span class='highlight'>è€•ã™</span>ã€‚", set:3},
            {q:"è£œã†", m:"ãŠããªã†", tr:"ë³´ì¶©í•˜ë‹¤", ex:"ä¸è¶³ã‚’<span class='highlight'>è£œã†</span>ã€‚", set:3},
            {q:"é˜²ã", m:"ãµã›ã", tr:"ë§‰ë‹¤/ë°©ì§€í•˜ë‹¤", ex:"äº‹æ•…ã‚’<span class='highlight'>é˜²ã</span>ã€‚", set:3},
            {q:"çœã", m:"ã¯ã¶ã", tr:"ìƒëµí•˜ë‹¤/ëœë‹¤", ex:"æ‰‹é–“ã‚’<span class='highlight'>çœã</span>ã€‚", set:3},
            {q:"ç–‘ã†", m:"ã†ãŸãŒã†", tr:"ì˜ì‹¬í•˜ë‹¤", ex:"ç›®ã‚’<span class='highlight'>ç–‘ã†</span>ã‚ˆã†ãªå…‰æ™¯ã€‚", set:3},
            {q:"æ•¬ã†", m:"ã†ã‚„ã¾ã†", tr:"ì¡´ê²½í•˜ë‹¤", ex:"å¹´å¯„ã‚Šã‚’<span class='highlight'>æ•¬ã†</span>ã€‚", set:3},
            {q:"é›‡ã†", m:"ã‚„ã¨ã†", tr:"ê³ ìš©í•˜ë‹¤", ex:"æ–°ã—ã„åº—å“¡ã‚’<span class='highlight'>é›‡ã†</span>ã€‚", set:3},
            {q:"å¿«ã„", m:"ã“ã“ã‚ã‚ˆã„", tr:"ìƒì¾Œí•˜ë‹¤/ê¸°ë¶„ ì¢‹ë‹¤", ex:"<span class='highlight'>å¿«ã„</span>è¿”äº‹ã€‚", set:3},
            {q:"æ†ã„", m:"ã«ãã„", tr:"ë°‰ë‹¤", ex:"ç½ªã‚’<span class='highlight'>æ†</span>ã‚“ã§äººã‚’æ†ã¾ãšã€‚", set:3},
            {q:"å¹¼ã„", m:"ãŠã•ãªã„", tr:"ì–´ë¦¬ë‹¤/ë¯¸ìˆ™í•˜ë‹¤", ex:"<span class='highlight'>å¹¼ã„</span>å­ä¾›ã€‚", set:3},
            {q:"å‹¢ã„", m:"ã„ããŠã„", tr:"ê¸°ì„¸/í˜", ex:"ã™ã”ã„<span class='highlight'>å‹¢ã„</span>ã§èµ°ã‚‹ã€‚", set:3},
            {q:"æ†§ã‚Œã‚‹", m:"ã‚ã“ãŒã‚Œã‚‹", tr:"ë™ê²½í•˜ë‹¤", ex:"ã‚¹ã‚¿ãƒ¼ã«<span class='highlight'>æ†§ã‚Œã‚‹</span>ã€‚", set:3},
            {q:"æš´ã‚Œã‚‹", m:"ã‚ã°ã‚Œã‚‹", tr:"ë‚œë™ì„ ë¶€ë¦¬ë‹¤", ex:"é…”ã£æ‰•ã£ã¦<span class='highlight'>æš´ã‚Œã‚‹</span>ã€‚", set:3},
            {q:"æººã‚Œã‚‹", m:"ãŠã¼ã‚Œã‚‹", tr:"ë¹ ì§€ë‹¤(ë¬¼/íƒë‹‰)", ex:"å·ã§<span class='highlight'>æººã‚Œã‚‹</span>ã€‚", set:3},
            {q:"é ¼ã‚‹", m:"ãŸã‚ˆã‚‹", tr:"ì˜ì§€í•˜ë‹¤", ex:"è¦ªã«<span class='highlight'>é ¼ã‚‹</span>ã€‚", set:3},
            {q:"æ•ã¾ã‚‹", m:"ã¤ã‹ã¾ã‚‹", tr:"ì¡íˆë‹¤", ex:"çŠ¯äººãŒ<span class='highlight'>æ•ã¾ã‚‹</span>ã€‚", set:3},
            {q:"åŠªã‚ã‚‹", m:"ã¤ã¨ã‚ã‚‹", tr:"ë…¸ë ¥í•˜ë‹¤", ex:"è§£æ±ºã«<span class='highlight'>åŠªã‚ã‚‹</span>ã€‚", set:3},
            {q:"å‹™ã‚ã‚‹", m:"ã¤ã¨ã‚ã‚‹", tr:"ì„ë¬´ë¥¼ ë§¡ë‹¤/ì—­í• ì„ í•˜ë‹¤", ex:"è­°é•·ã‚’<span class='highlight'>å‹™ã‚ã‚‹</span>ã€‚", set:3},
            {q:"å‹¤ã‚ã‚‹", m:"ã¤ã¨ã‚ã‚‹", tr:"ê·¼ë¬´í•˜ë‹¤", ex:"ä¼šç¤¾ã«<span class='highlight'>å‹¤ã‚ã‚‹</span>ã€‚", set:3},

            // Set 4: ì˜ˆì™¸/íŠ¹ìˆ˜ ì½ê¸° (Irregular Readings)
            {q:"æ˜æ—¥", m:"ã‚ã—ãŸ", tr:"ë‚´ì¼", ex:"<span class='highlight'>æ˜æ—¥</span>ã€ä¼šã„ã¾ã—ã‚‡ã†ã€‚", set:4},
            {q:"æ˜å¾Œæ—¥", m:"ã‚ã•ã£ã¦", tr:"ëª¨ë ˆ", ex:"<span class='highlight'>æ˜å¾Œæ—¥</span>ã¯ä¼‘ã¿ã ã€‚", set:4},
            {q:"æ˜¨æ—¥", m:"ãã®ã†", tr:"ì–´ì œ", ex:"<span class='highlight'>æ˜¨æ—¥</span>ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€‚", set:4},
            {q:"ä¸€æ˜¨æ—¥", m:"ãŠã¨ã¨ã„", tr:"ê·¸ì €ê»˜", ex:"<span class='highlight'>ä¸€æ˜¨æ—¥</span>ã€é›¨ãŒé™ã£ãŸã€‚", set:4},
            {q:"ä»Šæ—¥", m:"ãã‚‡ã†", tr:"ì˜¤ëŠ˜", ex:"<span class='highlight'>ä»Šæ—¥</span>ã¯ã„ã„å¤©æ°—ã ã€‚", set:4},
            {q:"å¤§äºº", m:"ãŠã¨ãª", tr:"ì–´ë¥¸", ex:"<span class='highlight'>å¤§äºº</span>ã®äº‹æƒ…ã€‚", set:4},
            {q:"å­ä¾›", m:"ã“ã©ã‚‚", tr:"ì•„ì´", ex:"<span class='highlight'>å­ä¾›</span>ãŒéŠã‚“ã§ã„ã‚‹ã€‚", set:4},
            {q:"å‹é”", m:"ã¨ã‚‚ã ã¡", tr:"ì¹œêµ¬", ex:"<span class='highlight'>å‹é”</span>ã¨éŠã¶ã€‚", set:4},
            {q:"äºŒåæ­³", m:"ã¯ãŸã¡", tr:"ìŠ¤ë¬´ ì‚´", ex:"ä»Šå¹´ã§<span class='highlight'>äºŒåæ­³</span>ã«ãªã‚‹ã€‚", set:4},
            {q:"è¿·å­", m:"ã¾ã„ã”", tr:"ë¯¸ì•„", ex:"ãƒ‡ãƒ‘ãƒ¼ãƒˆã§<span class='highlight'>è¿·å­</span>ã«ãªã‚‹ã€‚", set:4},
            {q:"çœ¼é¡", m:"ã‚ãŒã­", tr:"ì•ˆê²½", ex:"<span class='highlight'>çœ¼é¡</span>ã‚’ã‹ã‘ã‚‹ã€‚", set:4},
            {q:"çœŸé¢ç›®", m:"ã¾ã˜ã‚", tr:"ì„±ì‹¤í•¨", ex:"å½¼ã¯<span class='highlight'>çœŸé¢ç›®</span>ã ã€‚", set:4},
            {q:"ç´ äºº", m:"ã—ã‚ã†ã¨", tr:"ì•„ë§ˆì¶”ì–´/ì´ˆë³´ì", ex:"ç§ã¯<span class='highlight'>ç´ äºº</span>ã§ã™ã€‚", set:4},
            {q:"ç„äºº", m:"ãã‚ã†ã¨", tr:"ì „ë¬¸ê°€", ex:"<span class='highlight'>ç„äºº</span>å¥½ã¿ã®å‘³ã€‚", set:4},
            {q:"ä»²äºº", m:"ãªã“ã†ã©", tr:"ì¤‘ë§¤ì¸", ex:"çµå©šå¼ã®<span class='highlight'>ä»²äºº</span>ã€‚", set:4},
            {q:"ç”°èˆ", m:"ã„ãªã‹", tr:"ì‹œê³¨", ex:"<span class='highlight'>ç”°èˆ</span>ã«å¸°ã‚‹ã€‚", set:4},
            {q:"æœç‰©", m:"ãã ã‚‚ã®", tr:"ê³¼ì¼", ex:"å­£ç¯€ã®<span class='highlight'>æœç‰©</span>ã€‚", set:4},
            {q:"æ¢…é›¨", m:"ã¤ã‚†", tr:"ì¥ë§ˆ", ex:"<span class='highlight'>æ¢…é›¨</span>ãŒæ˜ã‘ã‚‹ã€‚", set:4},
            {q:"é›ªå´©", m:"ãªã ã‚Œ", tr:"ëˆˆì‚¬íƒœ", ex:"<span class='highlight'>é›ªå´©</span>ã«æ³¨æ„ã€‚", set:4},
            {q:"ç´…è‘‰", m:"ã‚‚ã¿ã˜", tr:"ë‹¨í’", ex:"<span class='highlight'>ç´…è‘‰</span>ãŒãã‚Œã„ã ã€‚", set:4},

            // Set 5: í•„ìˆ˜ í•œìì–´ (N3 Essential Compounds)
            {q:"å¹¸ç¦", m:"ã“ã†ãµã", tr:"í–‰ë³µ", ex:"<span class='highlight'>å¹¸ç¦</span>ãªç”Ÿæ´»ã€‚", set:5},
            {q:"å¹³ç­‰", m:"ã³ã‚‡ã†ã©ã†", tr:"í‰ë“±", ex:"ç”·å¥³ã¯<span class='highlight'>å¹³ç­‰</span>ã ã€‚", set:5},
            {q:"å¹³å‡", m:"ã¸ã„ãã‚“", tr:"í‰ê· ", ex:"<span class='highlight'>å¹³å‡</span>ç‚¹ã‚’å–ã‚‹ã€‚", set:5},
            {q:"åœ°çƒ", m:"ã¡ãã‚…ã†", tr:"ì§€êµ¬", ex:"<span class='highlight'>åœ°çƒ</span>ã¯ä¸¸ã„ã€‚", set:5},
            {q:"å®‡å®™", m:"ã†ã¡ã‚…ã†", tr:"ìš°ì£¼", ex:"<span class='highlight'>å®‡å®™</span>æ—…è¡Œã«è¡Œãã€‚", set:5},
            {q:"ç’°å¢ƒ", m:"ã‹ã‚“ãã‚‡ã†", tr:"í™˜ê²½", ex:"<span class='highlight'>ç’°å¢ƒ</span>ã‚’å®ˆã‚‹ã€‚", set:5},
            {q:"è³‡æº", m:"ã—ã’ã‚“", tr:"ìì›", ex:"<span class='highlight'>è³‡æº</span>ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚", set:5},
            {q:"ç¯€ç´„", m:"ã›ã¤ã‚„ã", tr:"ì ˆì•½", ex:"æ°´ã‚’<span class='highlight'>ç¯€ç´„</span>ã™ã‚‹ã€‚", set:5},
            {q:"ç®¡ç†", m:"ã‹ã‚“ã‚Š", tr:"ê´€ë¦¬", ex:"å¥åº·<span class='highlight'>ç®¡ç†</span>ã‚’ã™ã‚‹ã€‚", set:5},
            {q:"æ•´ç†", m:"ã›ã„ã‚Š", tr:"ì •ë¦¬", ex:"éƒ¨å±‹ã‚’<span class='highlight'>æ•´ç†</span>ã™ã‚‹ã€‚", set:5},
            {q:"å®Œæˆ", m:"ã‹ã‚“ã›ã„", tr:"ì™„ì„±", ex:"ä½œå“ãŒ<span class='highlight'>å®Œæˆ</span>ã—ãŸã€‚", set:5},
            {q:"å®Œå…¨ã«", m:"ã‹ã‚“ãœã‚“ã«", tr:"ì™„ì „íˆ", ex:"<span class='highlight'>å®Œå…¨ã«</span>ç†è§£ã—ãŸã€‚", set:5},
            {q:"å„ªå‹", m:"ã‚†ã†ã—ã‚‡ã†", tr:"ìš°ìŠ¹", ex:"è©¦åˆã§<span class='highlight'>å„ªå‹</span>ã™ã‚‹ã€‚", set:5},
            {q:"å¥³å„ª", m:"ã˜ã‚‡ã‚†ã†", tr:"ì—¬ë°°ìš°", ex:"æœ‰åãª<span class='highlight'>å¥³å„ª</span>ã€‚", set:5},
            {q:"æœ€åˆ", m:"ã•ã„ã—ã‚‡", tr:"ìµœì´ˆ/ì²˜ìŒ", ex:"<span class='highlight'>æœ€åˆ</span>ã®ãƒšãƒ¼ã‚¸ã€‚", set:5},
            {q:"æœ€å¾Œ", m:"ã•ã„ã”", tr:"ìµœí›„/ë§ˆì§€ë§‰", ex:"<span class='highlight'>æœ€å¾Œ</span>ã¾ã§è«¦ã‚ãªã„ã€‚", set:5},
            {q:"æœ€è¿‘", m:"ã•ã„ãã‚“", tr:"ìµœê·¼", ex:"<span class='highlight'>æœ€è¿‘</span>ã€å¿™ã—ã„ã€‚", set:5},
            {q:"æœ€é«˜", m:"ã•ã„ã“ã†", tr:"ìµœê³ ", ex:"<span class='highlight'>æœ€é«˜</span>ã®æ°—åˆ†ã ã€‚", set:5},
            {q:"éå¸¸", m:"ã²ã˜ã‚‡ã†", tr:"ë¹„ìƒ", ex:"<span class='highlight'>éå¸¸</span>å£ã¯ã“ã¡ã‚‰ã€‚", set:5},
            {q:"æ—¥å¸¸", m:"ã«ã¡ã˜ã‚‡ã†", tr:"ì¼ìƒ", ex:"<span class='highlight'>æ—¥å¸¸</span>ç”Ÿæ´»ã€‚", set:5}
        ];

        let quizList = [];
        let currentIdx = 0;
        let score = 0;
        let attempts = 0;
        let currentMode = 0;
        let timerInterval = null;
        let seconds = 0;
        let wrongAnswers = []; 
        let maxPossibleScore = 0;

        const wrapper = document.getElementById('jp-n3-3-wrapper');
        const elQWord = document.getElementById('qWord_n3_3');
        const elQExample = document.getElementById('qExample_n3_3');
        const elQHint = document.getElementById('qHint_n3_3');
        const elOptions = document.getElementById('qOptions_n3_3');
        const elNextBtn = document.getElementById('btnNext_n3_3');
        const elResult = document.getElementById('resultScreen_n3_3');
        const elFinalScore = document.getElementById('finalScore_n3_3');
        const elMaxScore = document.getElementById('maxScore_n3_3');
        const elWrongList = document.getElementById('wrongList_n3_3');
        const elWrongHeader = document.getElementById('wrongListHeader_n3_3');
        const elQCount = document.getElementById('qCount_n3_3');
        const elTimer = document.getElementById('timerDisplay_n3_3');
        const elLiveScore = document.getElementById('liveScore_n3_3');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setSize(size) {
            wrapper.classList.remove('size-small', 'size-large');
            const btns = wrapper.querySelectorAll('.size-btn');
            btns.forEach(b => b.classList.remove('active'));
            if (size === 'small') { wrapper.classList.add('size-small'); btns[0].classList.add('active'); }
            else if (size === 'large') { wrapper.classList.add('size-large'); btns[2].classList.add('active'); }
            else { btns[1].classList.add('active'); }
        }

        function changeSet(mode) {
            currentMode = mode;
            const btns = wrapper.querySelectorAll('.set-btn');
            btns.forEach(b => b.classList.remove('active'));
            let btnIdx = (mode === 'all') ? 5 : mode;
            btns[btnIdx].classList.add('active');
            initGame();
        }

        function initGame() {
            let targetData = [];
            if (currentMode === 'all') { targetData = shuffle([...dataPool]); }
            else {
                const start = currentMode * 20;
                const end = start + 20;
                targetData = shuffle(dataPool.slice(start, end));
            }
            quizList = targetData;
            currentIdx = 0; score = 0; wrongAnswers = []; maxPossibleScore = quizList.length * 10;
            elResult.style.display = 'none';
            updateStatus(); loadQuestion();
        }

        function loadQuestion() {
            if (currentIdx >= quizList.length) { finishGame(); return; }
            const data = quizList[currentIdx];
            attempts = 0; 
            resetTimer(); startTimer(); updateStatus();

            elQWord.innerText = data.q; 
            elQExample.innerHTML = data.ex;
            elQHint.style.display = 'none';
            elQHint.innerText = `ğŸ’¡ íŒíŠ¸: ${data.tr}`; 
            elNextBtn.style.display = 'none';
            elOptions.innerHTML = '';
            elOptions.classList.remove('disabled-area');

            let opts = [{txt: data.m, isAns: true}];
            let others = shuffle(dataPool.filter(d => d.m !== data.m)).slice(0, 3);
            others.forEach(o => opts.push({txt: o.m, isAns: false}));
            opts = shuffle(opts);

            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt.txt;
                btn.onclick = () => checkAnswer(btn, opt.isAns);
                elOptions.appendChild(btn);
            });
        }

        function checkAnswer(btn, isCorrect) {
            if (isCorrect) {
                stopTimer(); btn.classList.add('correct'); elOptions.classList.add('disabled-area');
                if (attempts === 0) {
                    let timeBonus = Math.max(2, 10 - Math.floor(seconds / 2)); 
                    score += timeBonus; updateStatus();
                    setTimeout(() => { nextQuestion(); }, 500);
                } else { elNextBtn.style.display = 'block'; }
            } else {
                btn.classList.add('wrong'); btn.disabled = true;
                if (attempts === 0) {
                    attempts = 1; elQHint.style.display = 'block'; 
                    const currentData = quizList[currentIdx];
                    if(!wrongAnswers.includes(currentData)) { wrongAnswers.push(currentData); }
                } else {
                    stopTimer(); elOptions.classList.add('disabled-area');
                    const correctTxt = quizList[currentIdx].m;
                    const allBtns = elOptions.querySelectorAll('.opt-btn');
                    allBtns.forEach(b => { if (b.innerText === correctTxt) b.classList.add('correct'); });
                    elNextBtn.style.display = 'block';
                }
            }
        }

        function startTimer() { seconds = 0; elTimer.innerText = "0s"; timerInterval = setInterval(() => { seconds++; elTimer.innerText = seconds + "s"; }, 1000); }
        function stopTimer() { clearInterval(timerInterval); }
        function resetTimer() { stopTimer(); seconds = 0; elTimer.innerText = "0s"; }
        function updateStatus() { elQCount.innerText = `${currentIdx + 1} / ${quizList.length}`; elLiveScore.innerText = score; }
        function nextQuestion() { currentIdx++; loadQuestion(); }

        function speak() {
            if (!('speechSynthesis' in window)) return;
            const data = quizList[currentIdx];
            const utt = new SpeechSynthesisUtterance(data.q);
            utt.lang = 'ja-JP'; utt.rate = 0.9;
            const voices = window.speechSynthesis.getVoices();
            const jaVoice = voices.find(v => v.lang.includes('ja') || v.lang.includes('JP'));
            if (jaVoice) utt.voice = jaVoice;
            window.speechSynthesis.cancel(); window.speechSynthesis.speak(utt);
        }
        if ('speechSynthesis' in window) { window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); }; }

        function finishGame() {
            stopTimer();
            elFinalScore.innerText = score; elMaxScore.innerText = maxPossibleScore;
            elWrongList.innerHTML = '';
            if (wrongAnswers.length === 0) {
                elWrongHeader.innerText = "âœ… í‹€ë¦° ë‹¨ì–´ ì—†ìŒ";
                elWrongList.innerHTML = '<div style="padding:10px; text-align:center;">ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤! ìš”ë¯¸ê°€ë‚˜ ë§ˆìŠ¤í„°!</div>';
            } else {
                elWrongHeader.innerText = `âŒ í‹€ë¦° ë‹¨ì–´ (ì´ ${wrongAnswers.length}ê°œ)`;
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'review-item';
                    div.innerHTML = `<div class="review-word">${item.q} (<span style="color:#7c3aed">${item.m}</span>)</div><div class="review-mean">${item.tr}</div>`;
                    elWrongList.appendChild(div);
                });
            }
            elResult.style.display = 'flex';
        }

        window.JpN3_3 = { setSize, changeSet, initGame, nextQuestion, speak };
        initGame();
    })();
    </script>
</body>
</html>
